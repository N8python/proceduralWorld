!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Nebula=e():t.Nebula=e()}(this,(function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=46)}([function(t,e,i){"use strict";(function(t){i.d(e,"d",(function(){return r})),i.d(e,"e",(function(){return n})),i.d(e,"a",(function(){return s})),i.d(e,"c",(function(){return o})),i.d(e,"b",(function(){return a})),i.d(e,"f",(function(){return h}));const r=3.142,n=500,s=r/180,o=100,a="euler",h=()=>!!t&&(t.env,!1)}).call(this,i(15))},function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},function(t,e,i){var r=i(3),n=i(4);t.exports=function(t){return"number"==typeof t||n(t)&&"[object Number]"==r(t)}},function(t,e,i){var r=i(7),n=i(29),s=i(30),o=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":o&&o in Object(t)?n(t):s(t)}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,i){var r=i(6),n=i(19),s=i(10);t.exports=function(t){return(s(t)?r:n)(t)}},function(t,e,i){var r=i(18);t.exports=function(t){var e=t.length;return e?t[r(0,e-1)]:void 0}},function(t,e,i){var r=i(8).Symbol;t.exports=r},function(t,e,i){var r=i(9),n="object"==typeof self&&self&&self.Object===Object&&self,s=r||n||Function("return this")();t.exports=s},function(t,e,i){(function(e){var i="object"==typeof e&&e&&e.Object===Object&&e;t.exports=i}).call(this,i(28))},function(t,e){var i=Array.isArray;t.exports=i},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},function(t,e,i){var r,n,s=i(16),o=i(17),a=0,h=0;t.exports=function(t,e,i){var u=e&&i||0,c=e||[],l=(t=t||{}).node||r,d=void 0!==t.clockseq?t.clockseq:n;if(null==l||null==d){var p=s();null==l&&(l=r=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==d&&(d=n=16383&(p[6]<<8|p[7]))}var f=void 0!==t.msecs?t.msecs:(new Date).getTime(),y=void 0!==t.nsecs?t.nsecs:h+1,m=f-a+(y-h)/1e4;if(m<0&&void 0===t.clockseq&&(d=d+1&16383),(m<0||f>a)&&void 0===t.nsecs&&(y=0),y>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,h=y,n=d;var g=(1e4*(268435455&(f+=122192928e5))+y)%4294967296;c[u++]=g>>>24&255,c[u++]=g>>>16&255,c[u++]=g>>>8&255,c[u++]=255&g;var x=f/4294967296*1e4&268435455;c[u++]=x>>>8&255,c[u++]=255&x,c[u++]=x>>>24&15|16,c[u++]=x>>>16&255,c[u++]=d>>>8|128,c[u++]=255&d;for(var v=0;v<6;++v)c[u+v]=l[v];return e||o(c)}},function(t,e,i){var r=i(45);t.exports=function(t,e){if(null==t)return{};var i,n,s=r(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)i=o[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(s[i]=t[i])}return s}},function(t,e){var i,r,n=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(t){i=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var h,u=[],c=!1,l=-1;function d(){c&&h&&(c=!1,h.length?u=h.concat(u):l=-1,u.length&&p())}function p(){if(!c){var t=a(d);c=!0;for(var e=u.length;e;){for(h=u,u=[];++l<e;)h&&h[l].run();l=-1,e=u.length}h=null,c=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function y(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new f(t,e)),1!==u.length||c||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=y,n.addListener=y,n.once=y,n.off=y,n.removeListener=y,n.removeAllListeners=y,n.emit=y,n.prependListener=y,n.prependOnceListener=y,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var r=new Uint8Array(16);t.exports=function(){return i(r),r}}else{var n=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),n[e]=t>>>((3&e)<<3)&255;return n}}},function(t,e){for(var i=[],r=0;r<256;++r)i[r]=(r+256).toString(16).substr(1);t.exports=function(t,e){var r=e||0,n=i;return[n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]]].join("")}},function(t,e){var i=Math.floor,r=Math.random;t.exports=function(t,e){return t+i(r()*(e-t+1))}},function(t,e,i){var r=i(6),n=i(20);t.exports=function(t){return r(n(t))}},function(t,e,i){var r=i(21),n=i(23);t.exports=function(t){return null==t?[]:r(t,n(t))}},function(t,e,i){var r=i(22);t.exports=function(t,e){return r(e,(function(e){return t[e]}))}},function(t,e){t.exports=function(t,e){for(var i=-1,r=null==t?0:t.length,n=Array(r);++i<r;)n[i]=e(t[i],i,t);return n}},function(t,e,i){var r=i(24),n=i(38),s=i(42);t.exports=function(t){return s(t)?r(t):n(t)}},function(t,e,i){var r=i(25),n=i(26),s=i(10),o=i(31),a=i(33),h=i(34),u=Object.prototype.hasOwnProperty;t.exports=function(t,e){var i=s(t),c=!i&&n(t),l=!i&&!c&&o(t),d=!i&&!c&&!l&&h(t),p=i||c||l||d,f=p?r(t.length,String):[],y=f.length;for(var m in t)!e&&!u.call(t,m)||p&&("length"==m||l&&("offset"==m||"parent"==m)||d&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||a(m,y))||f.push(m);return f}},function(t,e){t.exports=function(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}},function(t,e,i){var r=i(27),n=i(4),s=Object.prototype,o=s.hasOwnProperty,a=s.propertyIsEnumerable,h=r(function(){return arguments}())?r:function(t){return n(t)&&o.call(t,"callee")&&!a.call(t,"callee")};t.exports=h},function(t,e,i){var r=i(3),n=i(4);t.exports=function(t){return n(t)&&"[object Arguments]"==r(t)}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var r=i(7),n=Object.prototype,s=n.hasOwnProperty,o=n.toString,a=r?r.toStringTag:void 0;t.exports=function(t){var e=s.call(t,a),i=t[a];try{t[a]=void 0;var r=!0}catch(t){}var n=o.call(t);return r&&(e?t[a]=i:delete t[a]),n}},function(t,e){var i=Object.prototype.toString;t.exports=function(t){return i.call(t)}},function(t,e,i){(function(t){var r=i(8),n=i(32),s=e&&!e.nodeType&&e,o=s&&"object"==typeof t&&t&&!t.nodeType&&t,a=o&&o.exports===s?r.Buffer:void 0,h=(a?a.isBuffer:void 0)||n;t.exports=h}).call(this,i(11)(t))},function(t,e){t.exports=function(){return!1}},function(t,e){var i=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&i.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e,i){var r=i(35),n=i(36),s=i(37),o=s&&s.isTypedArray,a=o?n(o):r;t.exports=a},function(t,e,i){var r=i(3),n=i(12),s=i(4),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,t.exports=function(t){return s(t)&&n(t.length)&&!!o[r(t)]}},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,i){(function(t){var r=i(9),n=e&&!e.nodeType&&e,s=n&&"object"==typeof t&&t&&!t.nodeType&&t,o=s&&s.exports===n&&r.process,a=function(){try{var t=s&&s.require&&s.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=a}).call(this,i(11)(t))},function(t,e,i){var r=i(39),n=i(40),s=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return n(t);var e=[];for(var i in Object(t))s.call(t,i)&&"constructor"!=i&&e.push(i);return e}},function(t,e){var i=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||i)}},function(t,e,i){var r=i(41)(Object.keys,Object);t.exports=r},function(t,e){t.exports=function(t,e){return function(i){return t(e(i))}}},function(t,e,i){var r=i(43),n=i(12);t.exports=function(t){return null!=t&&n(t.length)&&!r(t)}},function(t,e,i){var r=i(3),n=i(44);t.exports=function(t){if(!n(t))return!1;var e=r(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e){t.exports=function(t,e){if(null==t)return{};var i,r,n={},s=Object.keys(t);for(r=0;r<s.length;r++)i=s[r],e.indexOf(i)>=0||(n[i]=t[i]);return n}},function(t,e,i){"use strict";i.r(e),i.d(e,"Alpha",(function(){return ze})),i.d(e,"Attraction",(function(){return Me})),i.d(e,"Collision",(function(){return Pe})),i.d(e,"Color",(function(){return Ee})),i.d(e,"CrossZone",(function(){return Oe})),i.d(e,"Force",(function(){return Te})),i.d(e,"Gravity",(function(){return Se})),i.d(e,"RandomDrift",(function(){return Ae})),i.d(e,"Repulsion",(function(){return Ce})),i.d(e,"Rotate",(function(){return je})),i.d(e,"Scale",(function(){return Re})),i.d(e,"Spring",(function(){return Ie})),i.d(e,"Behaviour",(function(){return we})),i.d(e,"Debug",(function(){return Ge})),i.d(e,"log",(function(){return Ye})),i.d(e,"ease",(function(){return h})),i.d(e,"easeLinear",(function(){return u})),i.d(e,"easeInQuad",(function(){return c})),i.d(e,"easeOutQuad",(function(){return l})),i.d(e,"easeInOutQuad",(function(){return d})),i.d(e,"easeInCubic",(function(){return p})),i.d(e,"easeOutCubic",(function(){return f})),i.d(e,"easeInOutCubic",(function(){return y})),i.d(e,"easeInQuart",(function(){return m})),i.d(e,"easeOutQuart",(function(){return g})),i.d(e,"easeInOutQuart",(function(){return x})),i.d(e,"easeInSine",(function(){return v})),i.d(e,"easeOutSine",(function(){return b})),i.d(e,"easeInOutSine",(function(){return _})),i.d(e,"easeInExpo",(function(){return w})),i.d(e,"easeOutExpo",(function(){return z})),i.d(e,"easeInOutExpo",(function(){return M})),i.d(e,"easeInCirc",(function(){return P})),i.d(e,"easeOutCirc",(function(){return E})),i.d(e,"easeInOutCirc",(function(){return O})),i.d(e,"easeInBack",(function(){return T})),i.d(e,"easeOutBack",(function(){return S})),i.d(e,"easeInOutBack",(function(){return A})),i.d(e,"setEasingByName",(function(){return C})),i.d(e,"getEasingByName",(function(){return j})),i.d(e,"FollowEmitter",(function(){return Xe})),i.d(e,"Emitter",(function(){return be})),i.d(e,"Body",(function(){return Ct})),i.d(e,"BodySprite",(function(){return Ft})),i.d(e,"InitializerUtil",(function(){return Lt})),i.d(e,"Life",(function(){return Ut})),i.d(e,"Mass",(function(){return Nt})),i.d(e,"Position",(function(){return ae})),i.d(e,"Radius",(function(){return he})),i.d(e,"Rate",(function(){return ue})),i.d(e,"Texture",(function(){return de})),i.d(e,"VectorVelocity",(function(){return me})),i.d(e,"PolarVelocity",(function(){return fe})),i.d(e,"RadialVelocity",(function(){return ye})),i.d(e,"ArraySpan",(function(){return ft})),i.d(e,"createArraySpan",(function(){return yt})),i.d(e,"ColorSpan",(function(){return mt})),i.d(e,"createColorSpan",(function(){return gt})),i.d(e,"Box",(function(){return xt})),i.d(e,"integrate",(function(){return Mt})),i.d(e,"MathUtils",(function(){return ut})),i.d(e,"Polar3D",(function(){return Et})),i.d(e,"Span",(function(){return ct})),i.d(e,"createSpan",(function(){return lt})),i.d(e,"Vector3D",(function(){return Pt})),i.d(e,"INTEGRATION_TYPE_EULER",(function(){return vt})),i.d(e,"INTEGRATION_TYPE_RK2",(function(){return bt})),i.d(e,"INTEGRATION_TYPE_RK4",(function(){return _t})),i.d(e,"INTEGRATION_TYPE_VERLET",(function(){return wt})),i.d(e,"CustomRenderer",(function(){return Qe})),i.d(e,"MeshRenderer",(function(){return He})),i.d(e,"SpriteRenderer",(function(){return We})),i.d(e,"GPURenderer",(function(){return vi})),i.d(e,"ColorUtil",(function(){return Q})),i.d(e,"PUID",(function(){return H})),i.d(e,"THREEUtil",(function(){return it})),i.d(e,"Util",(function(){return rt})),i.d(e,"uid",(function(){return st})),i.d(e,"withDefaults",(function(){return ht})),i.d(e,"BoxZone",(function(){return ee})),i.d(e,"LineZone",(function(){return ie})),i.d(e,"MeshZone",(function(){return re})),i.d(e,"PointZone",(function(){return ne})),i.d(e,"ScreenZone",(function(){return se})),i.d(e,"SphereZone",(function(){return oe})),i.d(e,"System",(function(){return Ue})),i.d(e,"Particle",(function(){return Ot})),i.d(e,"Pool",(function(){return Tt}));var r={};i.r(r),i.d(r,"BoxZone",(function(){return ee})),i.d(r,"LineZone",(function(){return ie})),i.d(r,"MeshZone",(function(){return re})),i.d(r,"PointZone",(function(){return ne})),i.d(r,"ScreenZone",(function(){return se})),i.d(r,"SphereZone",(function(){return oe}));var n={};i.r(n),i.d(n,"Body",(function(){return Ct})),i.d(n,"BodySprite",(function(){return Ft})),i.d(n,"InitializerUtil",(function(){return Lt})),i.d(n,"Life",(function(){return Ut})),i.d(n,"Mass",(function(){return Nt})),i.d(n,"Position",(function(){return ae})),i.d(n,"Radius",(function(){return he})),i.d(n,"Rate",(function(){return ue})),i.d(n,"Texture",(function(){return de})),i.d(n,"VectorVelocity",(function(){return me})),i.d(n,"PolarVelocity",(function(){return fe})),i.d(n,"RadialVelocity",(function(){return ye}));var s={};i.r(s),i.d(s,"Alpha",(function(){return ze})),i.d(s,"Attraction",(function(){return Me})),i.d(s,"Collision",(function(){return Pe})),i.d(s,"Color",(function(){return Ee})),i.d(s,"CrossZone",(function(){return Oe})),i.d(s,"Force",(function(){return Te})),i.d(s,"Gravity",(function(){return Se})),i.d(s,"RandomDrift",(function(){return Ae})),i.d(s,"Repulsion",(function(){return Ce})),i.d(s,"Rotate",(function(){return je})),i.d(s,"Scale",(function(){return Re})),i.d(s,"Spring",(function(){return Ie})),i.d(s,"Behaviour",(function(){return we}));const o=["BodySprite","Texture"];var a=i(0);const h={easeLinear:function(t){return t},easeInQuad:function(t){return Math.pow(t,2)},easeOutQuad:function(t){return-(Math.pow(t-1,2)-1)},easeInOutQuad:function(t){return(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2)},easeInCubic:function(t){return Math.pow(t,3)},easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeInOutCubic:function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},easeInQuart:function(t){return Math.pow(t,4)},easeOutQuart:function(t){return-(Math.pow(t-1,4)-1)},easeInOutQuart:function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},easeInSine:function(t){return 1-Math.cos(t*(a.d/2))},easeOutSine:function(t){return Math.sin(t*(a.d/2))},easeInOutSine:function(t){return-.5*(Math.cos(a.d*t)-1)},easeInExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},easeOutExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},easeInOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},easeInCirc:function(t){return-(Math.sqrt(1-t*t)-1)},easeOutCirc:function(t){return Math.sqrt(1-Math.pow(t-1,2))},easeInOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},easeInBack:function(t){var e=1.70158;return t*t*((e+1)*t-e)},easeOutBack:function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack:function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)}},{easeLinear:u,easeInQuad:c,easeOutQuad:l,easeInOutQuad:d,easeInCubic:p,easeOutCubic:f,easeInOutCubic:y,easeInQuart:m,easeOutQuart:g,easeInOutQuart:x,easeInSine:v,easeOutSine:b,easeInOutSine:_,easeInExpo:w,easeOutExpo:z,easeInOutExpo:M,easeInCirc:P,easeOutCirc:E,easeInOutCirc:O,easeInBack:T,easeOutBack:S,easeInOutBack:A}=h,C=t=>h[t]?h[t]:h.easeLinear,j=t=>h[t]?h[t]:h.easeLinear,R=u,I=["Position","Life","Radius","Mass","Body","BodySprite","Texture","PolarVelocity","RadialVelocity","VectorVelocity"],D=["Alpha","Attraction","Color","CrossZone","Force","Gravity","RandomDrift","Repulsion","Rotate","Scale","Spring"],B=["BoxZone","LineZone","MeshZone","PointZone","SphereZone"];var V,k,F,Z,L,U,N,q,G,Y,X=i(1),J=i.n(X),Q={getRGB:function(t){var e={};if("number"==typeof t)r=Math.floor(t),e.r=(t>>16&255)/255,e.g=(t>>8&255)/255,e.b=(255&t)/255;else if("string"==typeof t){var i;if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(t))e.r=Math.min(255,parseInt(i[1],10))/255,e.g=Math.min(255,parseInt(i[2],10))/255,e.b=Math.min(255,parseInt(i[3],10))/255;else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){var r=i[1];e.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,e.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,e.b=parseInt(r.charAt(4)+r.charAt(5),16)/255}}else e.r=t.r,e.g=t.g,e.b=t.b;return e}},H={_id:0,_uids:new Map,getNewId:function(){return"PUID_".concat(this._id++)},id:function(t){if(this._uids.has(t))return this._uids.get(t);const e=this.getNewId();return this._uids.set(t,e),e}},W={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return function(){var e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&r|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]).toUpperCase()}}(),clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*W.DEG2RAD},radToDeg:function(t){return t*W.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function K(t,e,i,r){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==r?r:1}function $(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}function tt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function et(t,e,i,r){this._x=t||0,this._y=e||0,this._z=i||0,this._order=r||et.DefaultOrder}Object.assign(K,{slerp:function(t,e,i,r){return i.copy(t).slerp(e,r)},slerpFlat:function(t,e,i,r,n,s,o){var a=i[r+0],h=i[r+1],u=i[r+2],c=i[r+3],l=n[s+0],d=n[s+1],p=n[s+2],f=n[s+3];if(c!==f||a!==l||h!==d||u!==p){var y=1-o,m=a*l+h*d+u*p+c*f,g=m>=0?1:-1,x=1-m*m;if(x>Number.EPSILON){var v=Math.sqrt(x),b=Math.atan2(v,m*g);y=Math.sin(y*b)/v,o=Math.sin(o*b)/v}var _=o*g;if(a=a*y+l*_,h=h*y+d*_,u=u*y+p*_,c=c*y+f*_,y===1-o){var w=1/Math.sqrt(a*a+h*h+u*u+c*c);a*=w,h*=w,u*=w,c*=w}}t[e]=a,t[e+1]=h,t[e+2]=u,t[e+3]=c}}),Object.defineProperties(K.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(K.prototype,{isQuaternion:!0,set:function(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=t._x,r=t._y,n=t._z,s=t.order,o=Math.cos,a=Math.sin,h=o(i/2),u=o(r/2),c=o(n/2),l=a(i/2),d=a(r/2),p=a(n/2);return"XYZ"===s?(this._x=l*u*c+h*d*p,this._y=h*d*c-l*u*p,this._z=h*u*p+l*d*c,this._w=h*u*c-l*d*p):"YXZ"===s?(this._x=l*u*c+h*d*p,this._y=h*d*c-l*u*p,this._z=h*u*p-l*d*c,this._w=h*u*c+l*d*p):"ZXY"===s?(this._x=l*u*c-h*d*p,this._y=h*d*c+l*u*p,this._z=h*u*p+l*d*c,this._w=h*u*c-l*d*p):"ZYX"===s?(this._x=l*u*c-h*d*p,this._y=h*d*c+l*u*p,this._z=h*u*p-l*d*c,this._w=h*u*c+l*d*p):"YZX"===s?(this._x=l*u*c+h*d*p,this._y=h*d*c+l*u*p,this._z=h*u*p-l*d*c,this._w=h*u*c-l*d*p):"XZY"===s&&(this._x=l*u*c-h*d*p,this._y=h*d*c-l*u*p,this._z=h*u*p+l*d*c,this._w=h*u*c+l*d*p),!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var i=e/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e,i=t.elements,r=i[0],n=i[4],s=i[8],o=i[1],a=i[5],h=i[9],u=i[2],c=i[6],l=i[10],d=r+a+l;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(c-h)*e,this._y=(s-u)*e,this._z=(o-n)*e):r>a&&r>l?(e=2*Math.sqrt(1+r-a-l),this._w=(c-h)/e,this._x=.25*e,this._y=(n+o)/e,this._z=(s+u)/e):a>l?(e=2*Math.sqrt(1+a-r-l),this._w=(s-u)/e,this._x=(n+o)/e,this._y=.25*e,this._z=(h+c)/e):(e=2*Math.sqrt(1+l-r-a),this._w=(o-n)/e,this._x=(s+u)/e,this._y=(h+c)/e,this._z=.25*e),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var i=t.dot(e)+1;return i<1e-6?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(W.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var i=this.angleTo(t);if(0===i)return this;var r=Math.min(1,e/i);return this.slerp(t,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,r=t._y,n=t._z,s=t._w,o=e._x,a=e._y,h=e._z,u=e._w;return this._x=i*u+s*o+r*h-n*a,this._y=r*u+s*a+n*o-i*h,this._z=n*u+s*h+i*a-r*o,this._w=s*u-i*o-r*a-n*h,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,r=this._y,n=this._z,s=this._w,o=s*t._w+i*t._x+r*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;var a=1-o*o;if(a<=Number.EPSILON){var h=1-e;return this._w=h*s+e*this._w,this._x=h*i+e*this._x,this._y=h*r+e*this._y,this._z=h*n+e*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(a),c=Math.atan2(u,o),l=Math.sin((1-e)*c)/u,d=Math.sin(e*c)/u;return this._w=s*l+this._w*d,this._x=i*l+this._x*d,this._y=r*l+this._y*d,this._z=n*l+this._z*d,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign($.prototype,{isVector3:!0,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:(k=new K,function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(k.setFromEuler(t))}),applyAxisAngle:function(){var t=new K;return function(e,i){return this.applyQuaternion(t.setFromAxisAngle(e,i))}}(),applyMatrix3:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*r,this.y=n[1]*e+n[4]*i+n[7]*r,this.z=n[2]*e+n[5]*i+n[8]*r,this},applyMatrix4:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements,s=1/(n[3]*e+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*r+n[12])*s,this.y=(n[1]*e+n[5]*i+n[9]*r+n[13])*s,this.z=(n[2]*e+n[6]*i+n[10]*r+n[14])*s,this},applyQuaternion:function(t){var e=this.x,i=this.y,r=this.z,n=t.x,s=t.y,o=t.z,a=t.w,h=a*e+s*r-o*i,u=a*i+o*e-n*r,c=a*r+n*i-s*e,l=-n*e-s*i-o*r;return this.x=h*a+l*-n+u*-o-c*-s,this.y=u*a+l*-s+c*-n-h*-o,this.z=c*a+l*-o+h*-s-u*-n,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*r,this.y=n[1]*e+n[5]*i+n[9]*r,this.z=n[2]*e+n[6]*i+n[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var i=t.x,r=t.y,n=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-n*o,this.y=n*s-i*a,this.z=i*o-r*s,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:(V=new $,function(t){return V.copy(this).projectOnVector(t),this.sub(V)}),reflect:function(){var t=new $;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(W.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,i){var r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(tt.prototype,{isMatrix4:!0,set:function(t,e,i,r,n,s,o,a,h,u,c,l,d,p,f,y){var m=this.elements;return m[0]=t,m[4]=e,m[8]=i,m[12]=r,m[1]=n,m[5]=s,m[9]=o,m[13]=a,m[2]=h,m[6]=u,m[10]=c,m[14]=l,m[3]=d,m[7]=p,m[11]=f,m[15]=y,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new tt).fromArray(this.elements)},copy:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},copyPosition:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},extractBasis:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this},extractRotation:function(){var t=new $;return function(e){var i=this.elements,r=e.elements,n=1/t.setFromMatrixColumn(e,0).length(),s=1/t.setFromMatrixColumn(e,1).length(),o=1/t.setFromMatrixColumn(e,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*o,i[9]=r[9]*o,i[10]=r[10]*o,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,i=t.x,r=t.y,n=t.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(r),h=Math.sin(r),u=Math.cos(n),c=Math.sin(n);if("XYZ"===t.order){var l=s*u,d=s*c,p=o*u,f=o*c;e[0]=a*u,e[4]=-a*c,e[8]=h,e[1]=d+p*h,e[5]=l-f*h,e[9]=-o*a,e[2]=f-l*h,e[6]=p+d*h,e[10]=s*a}else if("YXZ"===t.order){var y=a*u,m=a*c,g=h*u,x=h*c;e[0]=y+x*o,e[4]=g*o-m,e[8]=s*h,e[1]=s*c,e[5]=s*u,e[9]=-o,e[2]=m*o-g,e[6]=x+y*o,e[10]=s*a}else if("ZXY"===t.order){y=a*u,m=a*c,g=h*u,x=h*c;e[0]=y-x*o,e[4]=-s*c,e[8]=g+m*o,e[1]=m+g*o,e[5]=s*u,e[9]=x-y*o,e[2]=-s*h,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){l=s*u,d=s*c,p=o*u,f=o*c;e[0]=a*u,e[4]=p*h-d,e[8]=l*h+f,e[1]=a*c,e[5]=f*h+l,e[9]=d*h-p,e[2]=-h,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){var v=s*a,b=s*h,_=o*a,w=o*h;e[0]=a*u,e[4]=w-v*c,e[8]=_*c+b,e[1]=c,e[5]=s*u,e[9]=-o*u,e[2]=-h*u,e[6]=b*c+_,e[10]=v-w*c}else if("XZY"===t.order){v=s*a,b=s*h,_=o*a,w=o*h;e[0]=a*u,e[4]=-c,e[8]=h*u,e[1]=v*c+w,e[5]=s*u,e[9]=b*c-_,e[2]=_*c-b,e[6]=o*u,e[10]=w*c+v}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:(q=new $(0,0,0),G=new $(1,1,1),function(t){return this.compose(q,t,G)}),lookAt:(L=new $,U=new $,N=new $,function(t,e,i){var r=this.elements;return N.subVectors(t,e),0===N.lengthSq()&&(N.z=1),N.normalize(),L.crossVectors(i,N),0===L.lengthSq()&&(1===Math.abs(i.z)?N.x+=1e-4:N.z+=1e-4,N.normalize(),L.crossVectors(i,N)),L.normalize(),U.crossVectors(N,L),r[0]=L.x,r[4]=U.x,r[8]=N.x,r[1]=L.y,r[5]=U.y,r[9]=N.y,r[2]=L.z,r[6]=U.z,r[10]=N.z,this}),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,r=e.elements,n=this.elements,s=i[0],o=i[4],a=i[8],h=i[12],u=i[1],c=i[5],l=i[9],d=i[13],p=i[2],f=i[6],y=i[10],m=i[14],g=i[3],x=i[7],v=i[11],b=i[15],_=r[0],w=r[4],z=r[8],M=r[12],P=r[1],E=r[5],O=r[9],T=r[13],S=r[2],A=r[6],C=r[10],j=r[14],R=r[3],I=r[7],D=r[11],B=r[15];return n[0]=s*_+o*P+a*S+h*R,n[4]=s*w+o*E+a*A+h*I,n[8]=s*z+o*O+a*C+h*D,n[12]=s*M+o*T+a*j+h*B,n[1]=u*_+c*P+l*S+d*R,n[5]=u*w+c*E+l*A+d*I,n[9]=u*z+c*O+l*C+d*D,n[13]=u*M+c*T+l*j+d*B,n[2]=p*_+f*P+y*S+m*R,n[6]=p*w+f*E+y*A+m*I,n[10]=p*z+f*O+y*C+m*D,n[14]=p*M+f*T+y*j+m*B,n[3]=g*_+x*P+v*S+b*R,n[7]=g*w+x*E+v*A+b*I,n[11]=g*z+x*O+v*C+b*D,n[15]=g*M+x*T+v*j+b*B,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new $;return function(e){for(var i=0,r=e.count;i<r;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix4(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],i=t[4],r=t[8],n=t[12],s=t[1],o=t[5],a=t[9],h=t[13],u=t[2],c=t[6],l=t[10],d=t[14];return t[3]*(+n*a*c-r*h*c-n*o*l+i*h*l+r*o*d-i*a*d)+t[7]*(+e*a*d-e*h*l+n*s*l-r*s*d+r*h*u-n*a*u)+t[11]*(+e*h*c-e*o*d-n*s*c+i*s*d+n*o*u-i*h*u)+t[15]*(-r*o*u-e*a*c+e*o*l+r*s*c-i*s*l+i*a*u)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t,e,i){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this},getInverse:function(t,e){var i=this.elements,r=t.elements,n=r[0],s=r[1],o=r[2],a=r[3],h=r[4],u=r[5],c=r[6],l=r[7],d=r[8],p=r[9],f=r[10],y=r[11],m=r[12],g=r[13],x=r[14],v=r[15],b=p*x*l-g*f*l+g*c*y-u*x*y-p*c*v+u*f*v,_=m*f*l-d*x*l-m*c*y+h*x*y+d*c*v-h*f*v,w=d*g*l-m*p*l+m*u*y-h*g*y-d*u*v+h*p*v,z=m*p*c-d*g*c-m*u*f+h*g*f+d*u*x-h*p*x,M=n*b+s*_+o*w+a*z;if(0===M){var P="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(P);return console.warn(P),this.identity()}var E=1/M;return i[0]=b*E,i[1]=(g*f*a-p*x*a-g*o*y+s*x*y+p*o*v-s*f*v)*E,i[2]=(u*x*a-g*c*a+g*o*l-s*x*l-u*o*v+s*c*v)*E,i[3]=(p*c*a-u*f*a-p*o*l+s*f*l+u*o*y-s*c*y)*E,i[4]=_*E,i[5]=(d*x*a-m*f*a+m*o*y-n*x*y-d*o*v+n*f*v)*E,i[6]=(m*c*a-h*x*a-m*o*l+n*x*l+h*o*v-n*c*v)*E,i[7]=(h*f*a-d*c*a+d*o*l-n*f*l-h*o*y+n*c*y)*E,i[8]=w*E,i[9]=(m*p*a-d*g*a-m*s*y+n*g*y+d*s*v-n*p*v)*E,i[10]=(h*g*a-m*u*a+m*s*l-n*g*l-h*s*v+n*u*v)*E,i[11]=(d*u*a-h*p*a-d*s*l+n*p*l+h*s*y-n*u*y)*E,i[12]=z*E,i[13]=(d*g*o-m*p*o+m*s*f-n*g*f-d*s*x+n*p*x)*E,i[14]=(m*u*o-h*g*o-m*s*c+n*g*c+h*s*x-n*u*x)*E,i[15]=(h*p*o-d*u*o+d*s*c-n*p*c-h*s*f+n*u*f)*E,this},scale:function(t){var e=this.elements,i=t.x,r=t.y,n=t.z;return e[0]*=i,e[4]*=r,e[8]*=n,e[1]*=i,e[5]*=r,e[9]*=n,e[2]*=i,e[6]*=r,e[10]*=n,e[3]*=i,e[7]*=r,e[11]*=n,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),r=Math.sin(e),n=1-i,s=t.x,o=t.y,a=t.z,h=n*s,u=n*o;return this.set(h*s+i,h*o-r*a,h*a+r*o,0,h*o+r*a,u*o+i,u*a-r*s,0,h*a-r*o,u*a+r*s,n*a*a+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,i){var r=this.elements,n=e._x,s=e._y,o=e._z,a=e._w,h=n+n,u=s+s,c=o+o,l=n*h,d=n*u,p=n*c,f=s*u,y=s*c,m=o*c,g=a*h,x=a*u,v=a*c,b=i.x,_=i.y,w=i.z;return r[0]=(1-(f+m))*b,r[1]=(d+v)*b,r[2]=(p-x)*b,r[3]=0,r[4]=(d-v)*_,r[5]=(1-(l+m))*_,r[6]=(y+g)*_,r[7]=0,r[8]=(p+x)*w,r[9]=(y-g)*w,r[10]=(1-(l+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:(F=new $,Z=new tt,function(t,e,i){var r=this.elements,n=F.set(r[0],r[1],r[2]).length(),s=F.set(r[4],r[5],r[6]).length(),o=F.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),t.x=r[12],t.y=r[13],t.z=r[14],Z.copy(this);var a=1/n,h=1/s,u=1/o;return Z.elements[0]*=a,Z.elements[1]*=a,Z.elements[2]*=a,Z.elements[4]*=h,Z.elements[5]*=h,Z.elements[6]*=h,Z.elements[8]*=u,Z.elements[9]*=u,Z.elements[10]*=u,e.setFromRotationMatrix(Z),i.x=n,i.y=s,i.z=o,this}),makePerspective:function(t,e,i,r,n,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,a=2*n/(e-t),h=2*n/(i-r),u=(e+t)/(e-t),c=(i+r)/(i-r),l=-(s+n)/(s-n),d=-2*s*n/(s-n);return o[0]=a,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=h,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=l,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,i,r,n,s){var o=this.elements,a=1/(e-t),h=1/(i-r),u=1/(s-n),c=(e+t)*a,l=(i+r)*h,d=(s+n)*u;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-l,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,i=t.elements,r=0;r<16;r++)if(e[r]!==i[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}),et.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],et.DefaultOrder="XYZ",Object.defineProperties(et.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(et.prototype,{isEuler:!0,set:function(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var r=W.clamp,n=t.elements,s=n[0],o=n[4],a=n[8],h=n[1],u=n[5],c=n[9],l=n[2],d=n[6],p=n[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(a,p),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-l,s),this._z=0)):"ZXY"===e?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-l,p),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(h,s))):"ZYX"===e?(this._y=Math.asin(-r(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(h,s)):(this._x=0,this._z=Math.atan2(-o,u))):"YZX"===e?(this._z=Math.asin(r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-l,s)):(this._x=0,this._y=Math.atan2(a,p))):"XZY"===e?(this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==i&&this._onChangeCallback(),this},setFromQuaternion:function(){var t=new tt;return function(e,i,r){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,i,r)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:(Y=new K,function(t){return Y.setFromEuler(this),this.setFromQuaternion(Y,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new $(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var it={toScreenPos:function(){var t=new $;return function(e,i,r){return t.copy(e),t.project(i),t.x=Math.round((t.x+1)*r.width/2),t.y=Math.round((1-t.y)*r.height/2),t.z=0,t}}(),toSpacePos:function(){var t,e=new $,i=new $;return function(r,n,s){return e.set(r.x/s.width*2-1,-r.y/s.height*2+1,.5),e.unproject(n),i.copy(e.sub(n.position).normalize()),t=-n.position.z/i.z,e.copy(n.position),e.add(i.multiplyScalar(t)),e}}()},rt={initValue:function(t,e){return null!=t&&null!=t?t:e},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},destroyArray:function(t){t.length=0},destroyObject:function(t){for(var e in t)delete t[e]},isUndefined:function(){for(var t in arguments){var e=arguments[t];if(void 0!==e)return!1}return!0},setVectorByObj:function(t,e){void 0!==e.x&&(t.position.x=e.x),void 0!==e.y&&(t.position.y=e.y),void 0!==e.z&&(t.position.z=e.z),void 0!==e.vx&&(t.velocity.x=e.vx),void 0!==e.vy&&(t.velocity.y=e.vy),void 0!==e.vz&&(t.velocity.z=e.vz),void 0!==e.ax&&(t.acceleration.x=e.ax),void 0!==e.ay&&(t.acceleration.y=e.ay),void 0!==e.az&&(t.acceleration.z=e.az),void 0!==e.p&&t.position.copy(e.p),void 0!==e.v&&t.velocity.copy(e.v),void 0!==e.a&&t.acceleration.copy(e.a),void 0!==e.position&&t.position.copy(e.position),void 0!==e.velocity&&t.velocity.copy(e.velocity),void 0!==e.accelerate&&t.acceleration.copy(e.accelerate)},setPrototypeByObj:function(t,e,i){for(var r in e)t.hasOwnProperty(r)&&(i?i.indexOf(r)<0&&(t[r]=this._getValue(e[r])):t[r]=this._getValue(e[r]));return t},_getValue:function(t){return"Span"===t.constructor.type?t.getValue():t}},nt=i(13),st=i.n(nt).a;function ot(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function at(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ot(Object(i),!0).forEach((function(e){J()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ot(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}const ht=(t,e)=>at(at({},t),e);var ut={randomAToB:function(t,e,i){return i?(Math.random()*(e-t)>>0)+t:t+Math.random()*(e-t)},randomFloating:function(t,e,i){return this.randomAToB(t-e,t+e,i)},randomZone:function(t){},degreeTransform:function(t){return t*a.d/180},toColor16:function(t){return"#"+t.toString(16)},randomColor:function(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6)},lerp:function(t,e,i){return e+(t-e)*i},getNormal:function(t,e){return 0==t.x&&0==t.y?0==t.z?e.set(1,0,1):e.set(1,1,-t.y/t.z):0==t.x?e.set(1,0,1):e.set(-t.y/t.x,1,1),e.normalize()},axisRotate:function(t,e,i,r){var n=Math.cos(r),s=Math.sin(r),o=i.dot(e)*(1-n);t.copy(i),t.cross(e).scalar(s),t.addValue(e.x*n,e.y*n,e.z*n),t.addValue(i.x*o,i.y*o,i.z*o)}};class ct{constructor(t,e,i){this._isArray=!1,this.type="Span",rt.isArray(t)?(this._isArray=!0,this.a=t):(this.a=rt.initValue(t,1),this.b=rt.initValue(e,this.a),this._center=rt.initValue(i,!1))}getValue(t){return this._isArray?this.a[this.a.length*Math.random()>>0]:this._center?ut.randomFloating(this.a,this.b,t):ut.randomAToB(this.a,this.b,t)}}const lt=(t,e,i)=>t instanceof ct?t:void 0===e?new ct(t):void 0===i?new ct(t,e):new ct(t,e,i);var dt=i(5),pt=i.n(dt);class ft extends ct{constructor(t){super(),this.type="ArraySpan",this.items=Array.isArray(t)?t:[t]}getValue(){return pt()(this.items)}}const yt=t=>t?t instanceof ft?t:new ft(t):null;class mt extends ct{constructor(t){super(),this.type="ColorSpan",this.shouldRandomize="random"===t,this.colors=Array.isArray(t)?t:[t]}getValue(){return this.shouldRandomize?ut.randomColor():pt()(this.colors)}}const gt=t=>(t||(console.warn("Invalid colors argument ".concat(t," passed to createColorSpan. Defaulting to 'random'.")),t="random"),t instanceof mt?t:new mt(t));class xt{constructor(t,e,i,r,n,s){this.type="Box",this.x=t,this.y=e,this.z=i,this.width=r,this.height=n,this.depth=s,this.bottom=this.y+this.height,this.right=this.x+this.width,this.right=this.x+this.width}contains(t,e,i){return t<=this.right&&t>=this.x&&e<=this.bottom&&e>=this.y&&i<=this.depth&&i>=this.z}}const vt="EULER",bt="RUNGE_KUTTA_2",_t="RUNGE_KUTTA_4",wt="VERLET",zt=(t,e,i)=>{t.sleep||(t.old.position.copy(t.position),t.old.velocity.copy(t.velocity),t.acceleration.scalar(1/t.mass),t.velocity.add(t.acceleration.scalar(e)),t.position.add(t.old.velocity.scalar(e)),i&&t.velocity.scalar(i),t.acceleration.clear())},Mt=(t,e,i,r=vt)=>{switch(r){case vt:zt(t,e,i);break;default:zt(t,e,i)}};class Pt extends ${clear(){return this.x=0,this.y=0,this.z=0,this}scalar(t){return this.x*=t,this.y*=t,this.z*=t,this}addValue(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}toString(){return"x:"+this.x+"y:"+this.y+"z:"+this.z}eulerFromDir(t){return(new et).setFromVector3(t)}}class Et{constructor(t,e,i){this.type="Polar3D",this.radius=t||1,this.phi=i||0,this.theta=e||0}set(t,e,i){return this.radius=t||1,this.phi=i||0,this.theta=e||0,this}setRadius(t){return this.radius=t,this}setPhi(t){return this.phi=t,this}setTheta(t){return this.theta=t,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}toVector3D(){return new Pt(this.getX(),this.getY(),this.getZ())}getX(){return this.radius*Math.sin(this.theta)*Math.cos(this.phi)}getY(){return-this.radius*Math.sin(this.theta)*Math.sin(this.phi)}getZ(){return this.radius*Math.cos(this.theta)}normalize(){return this.radius=1,this}equals(t){return t.radius===this.radius&&t.phi===this.phi&&t.theta===this.theta}clear(){return this.radius=0,this.phi=0,this.theta=0,this}clone(){return new Et(this.radius,this.phi,this.theta)}}class Ot{constructor(t){this.id="particle-".concat(st()),this.type="Particle",this.life=1/0,this.age=0,this.energy=1,this.dead=!1,this.sleep=!1,this.body=null,this.parent=null,this.mass=1,this.radius=10,this.alpha=1,this.scale=1,this.useColor=!1,this.useAlpha=!1,this.easing=R,this.position=new Pt,this.velocity=new Pt,this.acceleration=new Pt,this.old={},this.old.position=this.position.clone(),this.old.velocity=this.velocity.clone(),this.old.acceleration=this.acceleration.clone(),this.behaviours=[],this.transform={},this.color={r:0,g:0,b:0},this.rotation=new Pt,this.distanceToCamera=0,rt.setPrototypeByObj(this,t)}getDirection(){return Math.atan2(this.velocity.x,-this.velocity.y)*(180/a.d)}reset(){return this.life=1/0,this.age=0,this.energy=1,this.dead=!1,this.sleep=!1,this.body=null,this.parent=null,this.mass=1,this.radius=10,this.alpha=1,this.scale=1,this.useColor=!1,this.useAlpha=!1,this.easing=R,this.position.set(0,0,0),this.velocity.set(0,0,0),this.acceleration.set(0,0,0),this.old.position.set(0,0,0),this.old.velocity.set(0,0,0),this.old.acceleration.set(0,0,0),this.color.r=0,this.color.g=0,this.color.b=0,this.rotation.clear(),rt.destroyObject(this.transform),this.removeAllBehaviours(),this}update(t,e){if(!this.sleep){this.age+=t;let i=this.behaviours.length;for(;i--;){this.behaviours[i].applyBehaviour(this,t,e)}}if(this.age>=this.life)this.destroy();else{const t=this.easing(this.age/this.life);this.energy=Math.max(1-t,0)}}addBehaviour(t){this.behaviours.push(t),t.initialize(this)}addBehaviours(t){let e=t.length;for(;e--;)this.addBehaviour(t[e])}removeBehaviour(t){const e=this.behaviours.indexOf(t);e>-1&&this.behaviours.splice(e,1)}removeAllBehaviours(){rt.destroyArray(this.behaviours)}destroy(){this.removeAllBehaviours(),this.energy=0,this.dead=!0,this.parent=null}}class Tt{constructor(){this.type="Pool",this.cID=0,this.list={}}create(t,...e){if(!this.canCreateNewObject(t))throw new Error("The pool is unable to create or clone the object supplied");return this.cID++,this.canInstantiateObject(t)?new t(...e):this.canCloneObject(t)?t.clone():void 0}canInstantiateObject(t){return"function"==typeof t}canCloneObject(t){return t.clone&&"function"==typeof t.clone}canCreateNewObject(t){return!(!this.canInstantiateObject(t)&&!this.canCloneObject(t))}getCount(){var t=0;for(var e in this.list)t+=this.list[e].length;return t++}get(t,...e){var i,r=t.__puid||H.id(t);return(i=this.list[r]&&this.list[r].length>0?this.list[r].pop():this.create(t,...e)).__puid=t.__puid||r,i}expire(t){return this._getList(t.__puid).push(t)}destroy(){for(var t in this.list)this.list[t].length=0,delete this.list[t]}_getList(t){return t=t||"default",this.list[t]||(this.list[t]=[]),this.list[t]}}var St=class{constructor(){this.listeners=null}set listeners(t){this._listeners=t}get listeners(){return this._listeners}addEventListener(t,e){return this.listeners?this.removeEventListener(t,e):this.listeners={},this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),e}removeEventListener(t,e){if(this.listeners&&this.listeners[t])for(var i=this.listeners[t],r=0,n=i.length;r<n;r++)if(i[r]==e){1==n?delete this.listeners[t]:i.splice(r,1);break}}removeAllEventListeners(t){t?this.listeners&&delete this.listeners[t]:this.listeners=null}dispatchEvent(t,e){var i=!1,r=this.listeners;if(t&&r){var n=r[t];if(!n)return i;for(var s,o=(n=n.slice()).length;o--;)s=n[o],i=i||s(e)}return!!i}hasEventListener(t){var e=this.listeners;return!(!e||!e[t])}};class At{constructor(t="Initializer",e=!0){this.type=t,this.isEnabled=e}init(t,e){this.isEnabled&&(e?(this.initialize(e),e.hasBeenInitialized=!0):(this.initialize(t),t.hasBeenInitialized=!0))}reset(){}initialize(t){}static requiresWebGlApi(){return!1}static fromJSON(t){}}class Ct extends At{constructor(t,e,i,r=!0){super("Body",r),this.body=yt(t),this.w=e,this.h=i||e}initialize(t){var e=this.body.getValue();this.w?t.body={width:this.w,height:this.h,body:e}:t.body=e}static fromJSON(t){const{body:e,width:i,height:r,isEnabled:n=!0}=t;return new Ct(e,i,r,n)}}function jt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function Rt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?jt(Object(i),!0).forEach((function(e){J()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):jt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}const It={AdditiveBlending:2,CustomBlending:5,MultiplyBlending:4,NoBlending:0,NormalBlending:1,SubtractiveBlending:3},Dt={color:16711680,blending:2,fog:!0},Bt=Rt(Rt({},Dt),{},{blending:"AdditiveBlending"});function Vt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function kt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Vt(Object(i),!0).forEach((function(e){J()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Vt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}class Ft extends At{constructor(t,e,i=Dt,r=!0){super("BodySprite",r);const{Sprite:n,SpriteMaterial:s,TextureLoader:o}=t;this.materialProperties=ht(Dt,i),(new o).load(e,t=>{this.texture=t,this.material=new s(kt(kt({},{map:t}),this.materialProperties)),this.sprite=new n(this.material)},void 0,t=>{throw new Error(t)})}initialize(t){t.body=this.sprite}static fromJSON(t,e){const{texture:i,materialProperties:r=Bt,isEnabled:n=!0}=t;return new Ft(e,i,ht(Bt,(t=>{const{blending:e}=t;return kt(kt({},t),{},{blending:e?It[e]:It[Bt.blending]})})(r)),n)}}const Zt=new et;var Lt={particleEuler:null,initialize:function(t,e,i){let r=i.length;for(;r--;)i[r].init(t,e);t.bindEmitter&&this.bindEmitter(t,e)},bindEmitter:function(t,e){const{rotation:{x:i,y:r,z:n}}=t;e.position.add(t.position),e.velocity.add(t.velocity),e.acceleration.add(t.acceleration),e.velocity.applyEuler(Zt.set(i,r,n))}};class Ut extends At{constructor(t,e,i,r=!0){super("Life",r),this.lifePan=lt(t,e,i)}initialize(t){this.lifePan.a==1/0||"infi"==this.lifePan.a?t.life=1/0:t.life=this.lifePan.getValue()}static fromJSON(t){const{min:e,max:i,center:r=!1,isEnabled:n=!0}=t;return new Ut(e,i,r,n)}}class Nt extends At{constructor(t,e,i=!1,r=!0){super("Mass",r),this.massPan=lt(t,e,i)}initialize(t){t.mass=this.massPan.getValue()}static fromJSON(t){const{min:e,max:i,center:r=!1,isEnabled:n=!0}=t;return new Nt(e,i,r,n)}}var qt,Gt,Yt,Xt,Jt,Qt,Ht,Wt,Kt=i(14),$t=i.n(Kt);class te{constructor(t="Zone"){this.type=t,this.vector=new Pt(0,0,0),this.random=0,this.crossType="dead",this.log=!0,this.supportsCrossing=!0}getPosition(){return null}crossing(t){if(!this.supportsCrossing)return console.warn("".concat(this.constructor.name," does not support the crossing method"));switch(this.crossType){case"bound":this._bound(t);break;case"cross":this._cross(t);break;case"dead":this._dead(t)}}isBoxZone(){return!1}isLineZone(){return!1}isMeshZone(){return!1}isPointZone(){return!1}isScreenZone(){return!1}isSphereZone(){return!1}_dead(t){}_bound(t){}_cross(t){}}class ee extends te{constructor(t,e,i,r,n,s){var o,a,h,u,c;super("BoxZone"),rt.isUndefined(e,i,r,n,s)?(o=a=h=0,u=c=r=t||100):rt.isUndefined(r,n,s)?(o=a=h=0,u=t,c=e,r=i):(o=t,a=e,h=i,u=r,c=n,r=s),this.x=o,this.y=a,this.z=h,this.width=u,this.height=c,this.depth=r,this.friction=.85,this.max=6}isBoxZone(){return!0}getPosition(){return this.vector.x=this.x+ut.randomAToB(-.5,.5)*this.width,this.vector.y=this.y+ut.randomAToB(-.5,.5)*this.height,this.vector.z=this.z+ut.randomAToB(-.5,.5)*this.depth,this.vector}_dead(t){(t.position.x+t.radius<this.x-this.width/2||t.position.x-t.radius>this.x+this.width/2)&&(t.dead=!0),(t.position.y+t.radius<this.y-this.height/2||t.position.y-t.radius>this.y+this.height/2)&&(t.dead=!0),(t.position.z+t.radius<this.z-this.depth/2||t.position.z-t.radius>this.z+this.depth/2)&&(t.dead=!0)}_bound(t){t.position.x-t.radius<this.x-this.width/2?(t.position.x=this.x-this.width/2+t.radius,t.velocity.x*=-this.friction,this._static(t,"x")):t.position.x+t.radius>this.x+this.width/2&&(t.position.x=this.x+this.width/2-t.radius,t.velocity.x*=-this.friction,this._static(t,"x")),t.position.y-t.radius<this.y-this.height/2?(t.position.y=this.y-this.height/2+t.radius,t.velocity.y*=-this.friction,this._static(t,"y")):t.position.y+t.radius>this.y+this.height/2&&(t.position.y=this.y+this.height/2-t.radius,t.velocity.y*=-this.friction,this._static(t,"y")),t.position.z-t.radius<this.z-this.depth/2?(t.position.z=this.z-this.depth/2+t.radius,t.velocity.z*=-this.friction,this._static(t,"z")):t.position.z+t.radius>this.z+this.depth/2&&(t.position.z=this.z+this.depth/2-t.radius,t.velocity.z*=-this.friction,this._static(t,"z"))}_static(t,e){t.velocity[e]*t.acceleration[e]>0||Math.abs(t.velocity[e])<.0167*Math.abs(t.acceleration[e])*this.max&&(t.velocity[e]=0,t.acceleration[e]=0)}_cross(t){t.position.x+t.radius<this.x-this.width/2&&t.velocity.x<=0?t.position.x=this.x+this.width/2+t.radius:t.position.x-t.radius>this.x+this.width/2&&t.velocity.x>=0&&(t.position.x=this.x-this.width/2-t.radius),t.position.y+t.radius<this.y-this.height/2&&t.velocity.y<=0?t.position.y=this.y+this.height/2+t.radius:t.position.y-t.radius>this.y+this.height/2&&t.velocity.y>=0&&(t.position.y=this.y-this.height/2-t.radius),t.position.z+t.radius<this.z-this.depth/2&&t.velocity.z<=0?t.position.z=this.z+this.depth/2+t.radius:t.position.z-t.radius>this.z+this.depth/2&&t.velocity.z>=0&&(t.position.z=this.z-this.depth/2-t.radius)}}class ie extends te{constructor(t,e,i,r,n,s){super("LineZone"),t instanceof Pt?(this.x1=t.x,this.y1=t.y,this.z1=t.z,this.x2=r.x,this.y2=r.y,this.z2=r.z):(this.x1=t,this.y1=e,this.z1=i,this.x2=r,this.y2=n,this.z2=s),this.supportsCrossing=!1}isLineZone(){return!0}getPosition(){return this.random=Math.random(),this.vector.x=this.x1+this.random*(this.x2-this.x1),this.vector.y=this.y1+this.random*(this.y2-this.y1),this.vector.z=this.z1+this.random*(this.z2-this.z1),this.vector}}class re extends te{constructor(t,e=1,i){if(super("MeshZone"),this.geometry=null,this.scale=e,this.supportsCrossing=!1,t.type&&"Geometry"===t.type&&(this.geometry=t),t.geometry&&(this.geometry=t.geometry),!this.geometry)throw new Error("MeshZone unable to set geometry from the supplied bounds");this.geometry.isBufferGeometry&&(this.geometry=(new i).fromBufferGeometry(this.geometry))}isMeshZone(){return!0}getPosition(){const t=this.geometry.vertices,e=t[t.length*Math.random()>>0];return this.vector.x=e.x*this.scale,this.vector.y=e.y*this.scale,this.vector.z=e.z*this.scale,this.vector}}class ne extends te{constructor(t,e,i){var r;super("PointZone"),rt.isUndefined(t,e,i)?r=0:(r=t,e),this.x=r,this.y=r,this.z=r,this.supportsCrossing=!1}isPointZone(){return!0}getPosition(){return this.vector.x=this.x,this.vector.y=this.y,this.vector.z=this.z,this.vector}}class se extends te{constructor(t,e,i,r){super("ScreenZone"),this.camera=t,this.renderer=e,this.dis=i||20,r=r||"1234";for(var n=1;n<5;n++)this["d"+n]=r.indexOf(n+"")>=0}isScreenZone(){return!0}_dead(t){var e=it.toScreenPos(t.position,this.camera,this.renderer.domElement),i=this.renderer.domElement;(e.y+t.radius<-this.dis&&this.d1||e.y-t.radius>i.height+this.dis&&this.d3)&&(t.dead=!0),(e.x+t.radius<-this.dis&&this.d4||e.x-t.radius>i.width+this.dis&&this.d2)&&(t.dead=!0)}_bound(t){var e=it.toScreenPos(t.position,this.camera,this.renderer.domElement),i=this.renderer.domElement;(e.y+t.radius<-this.dis||e.y-t.radius>i.height+this.dis)&&(t.velocity.y*=-1),(e.x+t.radius<-this.dis||e.x-t.radius>i.width+this.dis)&&(t.velocity.y*=-1)}}se.prototype.getPosition=(Gt=new Pt,function(){return qt=this.renderer.domElement,Gt.x=Math.random()*qt.width,Gt.y=Math.random()*qt.height,this.vector.copy(it.toSpacePos(Gt,this.camera,qt)),this.vector}),se.prototype._cross=function(){var t=new Pt;return function(e){var i=it.toScreenPos(e.position,this.camera,this.renderer.domElement),r=this.renderer.domElement;i.y+e.radius<-this.dis?(t.x=i.x,t.y=r.height+this.dis+e.radius,e.position.y=it.toSpacePos(t,this.camera,r).y):i.y-e.radius>r.height+this.dis&&(t.x=i.x,t.y=-this.dis-e.radius,e.position.y=it.toSpacePos(t,this.camera,r).y),i.x+e.radius<-this.dis?(t.y=i.y,t.x=r.width+this.dis+e.radius,e.position.x=it.toSpacePos(t,this.camera,r).x):i.x-e.radius>r.width+this.dis&&(t.y=i.y,t.x=-this.dis-e.radius,e.position.x=it.toSpacePos(t,this.camera,r).x)}}();class oe extends te{constructor(t,e,i,r){let n,s,o,a;super("SphereZone"),rt.isUndefined(e,i,r)?(n=s=o=0,a=t||100):(n=t,s=e,o=i,a=r),this.x=n,this.y=n,this.z=n,this.radius=a,this.the=this.phi=0}isSphereZone(){return!0}_dead(t){t.position.distanceTo(this)-t.radius>this.radius&&(t.dead=!0)}_cross(){console.warn("".concat(this.constructor.name," does not support the _cross method"))}}oe.prototype.getPosition=function(){return this.random=Math.random(),Jt=this.random*this.radius,Yt=a.d*Math.random(),Xt=2*a.d*Math.random(),this.vector.x=this.x+Jt*Math.sin(Yt)*Math.cos(Xt),this.vector.y=this.y+Jt*Math.sin(Xt)*Math.sin(Yt),this.vector.z=this.z+Jt*Math.cos(Yt),this.vector},oe.prototype._bound=(Ht=new Pt,Wt=new Pt,function(t){t.position.distanceTo(this)+t.radius>=this.radius&&(Ht.copy(t.position).sub(this).normalize(),Wt.copy(t.velocity),Qt=2*Wt.dot(Ht),t.velocity.sub(Ht.scalar(Qt)))});class ae extends At{constructor(){super("Position"),this.reset.apply(this,arguments)}reset(){this.zones?this.zones.length=0:this.zones=[],this.zones=this.zones.concat(Array.prototype.slice.call(arguments))}addZone(){this.zones=this.zones.concat(Array.prototype.slice.call(arguments))}static fromJSON(t){const{zoneType:e}=t,i=$t()(t,["zoneType"]);if(!B.includes(e))throw new Error("The zone type ".concat(e," is invalid or not yet supported"));return new ae(new r[e](...Object.values(i)))}}ae.prototype.initialize=function(){let t;return function(e){t=this.zones[Math.random()*this.zones.length>>0],t.getPosition(),e.position.x=t.vector.x,e.position.y=t.vector.y,e.position.z=t.vector.z}}();class he extends At{constructor(t,e,i=!1,r=!0){super("Radius",r),this.radius=lt(t,e,i)}reset(t,e,i=!1){this.radius=lt(t,e,i)}initialize(t){t.radius=this.radius.getValue(),t.transform.oldRadius=t.radius}static fromJSON(t){const{width:e,height:i,center:r=!1,isEnabled:n=!0}=t;return new he(e,i,r,n)}}class ue extends At{constructor(t=1,e=1){super("Rate"),this.numPan=lt(t),this.timePan=lt(e),this.startTime=0,this.nextTime=0,this.init()}init(){this.startTime=0,this.nextTime=this.timePan.getValue()}getValue(t){return this.startTime+=t,this.startTime>=this.nextTime?(this.init(),1==this.numPan.b?this.numPan.getValue("Float")>.5?1:0:this.numPan.getValue("Int")):0}static fromJSON(t){const{particlesMin:e,particlesMax:i,perSecondMin:r,perSecondMax:n}=t;return new ue(new ct(e,i),new ct(r,n))}}function ce(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function le(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ce(Object(i),!0).forEach((function(e){J()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ce(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}class de extends At{constructor(t,e,i=Dt,r=!0){super("Texture",r);const{Sprite:n,SpriteMaterial:s}=t;this.materialProperties=ht(Dt,i),this.texture=e,this.material=new s(le(le({},{map:e}),this.materialProperties)),this.sprite=new n(this.material)}initialize(t){t.body=this.sprite}static fromJSON(t,e){const{loadedTexture:i,materialProperties:r=Bt,isEnabled:n=!0}=t;return new de(e,i,ht(Bt,(t=>{const{blending:e}=t;return le(le({},t),{},{blending:e?It[e]:It[Bt.blending]})})(r)),n)}}class pe extends At{constructor(t,e=!0){super(t,e),this.dirVec=new Pt(0,0,0)}normalize(t){return t*a.c}}pe.prototype.initialize=function(){var t,e=new Pt(0,0,1),i=new Pt(0,0,0);return function(r){return t=this.tha*Math.random(),this._useV&&this.dirVec.copy(this.dir).scalar(this.radiusPan.getValue()),ut.getNormal(this.dirVec,e),i.copy(this.dirVec).applyAxisAngle(e,t),i.applyAxisAngle(this.dirVec.normalize(),Math.random()*a.d*2),r.velocity.copy(i),this}}();class fe extends pe{constructor(t,e,i=!0){super("PolarVelocity",i),this.tha=e*a.a,this.dirVec=t.toVector3D(),this._useV=!1}static fromJSON(t){const{polarRadius:e,polarTheta:i,polarPhi:r,velocityTheta:n,isEnabled:s=!0}=t;return new fe(new Et(e,i,r),n,s)}}class ye extends pe{constructor(t,e,i,r=!0){super("RadialVelocity",r),this.radiusPan=lt(t),this.dir=e.clone().normalize(),this.tha=i*a.a,this._useV=!0}static fromJSON(t){const{radius:e,x:i,y:r,z:n,theta:s,isEnabled:o=!0}=t;return new ye(e,new Pt(i,r,n),s,o)}}class me extends pe{constructor(t,e,i=!0){super("VectorVelocity",i),this.radiusPan=lt(1),this.dir=t.clone(),this.tha=e*a.a,this._useV=!0}static fromJSON(t){const{x:e,y:i,z:r,theta:n,isEnabled:s=!0}=t;return new me(new Pt(e,i,r),n,s)}}const ge=new ue(1,.1);var xe=i(2),ve=i.n(xe);class be extends Ot{constructor(t){super(t),this.type="Emitter",this.particles=[],this.initializers=[],this.behaviours=[],this.emitterBehaviours=[],this.currentEmitTime=0,this.totalEmitTimes=-1,this.damping=.006,this.bindEmitter=!0,this.bindEmitterEvent=!1,this.rate=ge,this.isEmitting=!1,this.id="emitter-".concat(st()),this.cID=0,this.name="Emitter",this.index=void 0,this.eventDispatcher=new St}dispatch(t,e=this){this.eventDispatcher.dispatchEvent(t,e)}setRate(t){return this.rate=t,this}setPosition(t={}){const{position:e}=this,{x:i=e.x,y:r=e.y,z:n=e.z}=t;return this.position.set(i,r,n),this}setRotation(t={}){const{rotation:e}=this,{x:i=e.x,y:r=e.y,z:n=e.z}=t;return this.rotation.set(i,r,n),this}emit(t=1/0,e=1/0){return this.currentEmitTime=0,this.totalEmitTimes=ve()(t)?t:1/0,this.life=1===t?t:ve()(e)?e:1/0,this.rate.init(),this.isEmitting=!0,this}experimental_emit(){const{isEmitting:t,totalEmitTimes:e,life:i}=this;return t||(this.currentEmitTime=0,e||this.setTotalEmitTimes(1/0),i||this.setLife(1/0),this.rate.init(),this.isEmitting=!0),this}setTotalEmitTimes(t=1/0){return this.totalEmitTimes=ve()(t)?t:1/0,this}setLife(t=1/0){return 1===this.totalEmitTimes?this.life=this.totalEmitTimes:this.life=ve()(t)?t:1/0,this}stopEmit(){this.totalEmitTimes=-1,this.currentEmitTime=0,this.isEmitting=!1}removeAllParticles(){let t=this.particles.length;for(;t--;)this.particles[t].dead=!0}addInitializer(t){return this.initializers.push(t),this}addInitializers(t){let e=t.length;for(;e--;)this.addInitializer(t[e]);return this}setInitializers(t){return this.initializers=t,this}removeInitializer(t){const e=this.initializers.indexOf(t);return e>-1&&this.initializers.splice(e,1),this}removeAllInitializers(){return rt.destroyArray(this.initializers),this}addBehaviour(t){return this.behaviours.push(t),this}addBehaviours(t){let e=t.length;for(;e--;)this.addBehaviour(t[e]);return this}setBehaviours(t){return this.behaviours=t,this}removeBehaviour(t){const e=this.behaviours.indexOf(t);return e>-1&&this.behaviours.splice(e,1),this}removeAllBehaviours(){return rt.destroyArray(this.behaviours),this}addEmitterBehaviour(t){return this.emitterBehaviours.push(t),t.initialize(this),this}addEmitterBehaviours(t){let e=t.length;for(;e--;)this.addEmitterBehaviour(t[e]);return this}setEmitterBehaviours(t){const e=t.length;this.emitterBehaviours=t;for(let t=0;t<e;t++)this.emitterBehaviours[t].initialize(this);return this}removeEmitterBehaviour(t){const e=this.emitterBehaviours.indexOf(t);return e>-1&&this.emitterBehaviours.splice(e,1),this}removeAllEmitterBehaviours(){return rt.destroyArray(this.emitterBehaviours),this}addOnEmitterDeadEventListener(t){return this.eventDispatcher.addEventListener("".concat(this.id,"_").concat("EMITTER_DEAD"),()=>t()),this}createParticle(){const t=this.parent.pool.get(Ot),e=this.particles.length;return this.setupParticle(t,e),this.parent&&this.parent.dispatch("PARTICLE_CREATED",t),this.bindEmitterEvent&&this.dispatch("PARTICLE_CREATED",t),t}setupParticle(t,e){const{initializers:i,behaviours:r}=this;Lt.initialize(this,t,i),t.addBehaviours(r),t.parent=this,t.index=e,this.particles.push(t)}update(t){if(!this.isEmitting)return;this.age+=t,(this.dead||this.age>=this.life)&&this.destroy(),this.generate(t),this.integrate(t);let e=this.particles.length;for(;e--;){const t=this.particles[e];t.dead&&(this.parent&&this.parent.dispatch("PARTICLE_DEAD",t),this.bindEmitterEvent&&this.dispatch("PARTICLE_DEAD",t),this.parent.pool.expire(t.reset()),this.particles.splice(e,1))}this.updateEmitterBehaviours(t)}updateEmitterBehaviours(t){if(this.sleep)return;const e=this.emitterBehaviours.length;for(let i=0;i<e;i++)this.emitterBehaviours[i].applyBehaviour(this,t,i)}integrate(t){const e=this.parent?this.parent.integrationType:vt,i=1-this.damping;Mt(this,t,i,e);let r=this.particles.length;for(;r--;){const n=this.particles[r];n.update(t,r),Mt(n,t,i,e),this.parent&&this.parent.dispatch("PARTICLE_UPDATE",n),this.bindEmitterEvent&&this.dispatch("PARTICLE_UPDATE",n)}}generate(t){if(1!==this.totalEmitTimes){if(this.currentEmitTime+=t,this.currentEmitTime<this.totalEmitTimes){let e=this.rate.getValue(t);for(e>0&&(this.cID=e);e--;)this.createParticle()}}else{let t=this.rate.getValue(99999);for(t>0&&(this.cID=t);t--;)this.createParticle();this.totalEmitTimes=0}}destroy(){this.dead=!0,this.energy=0,this.totalEmitTimes=-1,0==this.particles.length&&(this.isEmitting=!1,this.removeAllInitializers(),this.removeAllBehaviours(),this.dispatch("".concat(this.id,"_").concat("EMITTER_DEAD")),this.parent&&this.parent.removeEmitter(this))}}const _e=u;class we{constructor(t=1/0,e=_e,i="Behaviour",r=!0){this.type=i,this.isEnabled=r,this.id="behaviour-".concat(st()),this.life=t,this.easing=e,this.age=0,this.energy=1,this.dead=!1}reset(t=1/0,e=_e){this.life=t,this.easing=e||_e}set life(t){this._life=ve()(t)?t:1/0}get life(){return this._life}normalizeForce(t){return t.scalar(a.c)}normalizeValue(t){return t*a.c}initialize(t){}applyBehaviour(t,e,i){this.isEnabled&&this.mutate(t,e,i)}mutate(t,e,i){}energize(t,e){if(this.dead)return;if(this.age+=e,this.age>=this.life)return this.energy=0,void(this.dead=!0);const i=this.easing(t.age/t.life);this.energy=Math.max(1-i,0)}destroy(){}fromJSON(t){}}class ze extends we{constructor(t=1,e=null,i,r,n=!0){super(i,r,"Alpha",n),this.alphaA=t,this.alphaB=e,this.reset(t,e)}get same(){return this._same}set same(t){this._same=t}reset(t=1,e=null,i,r){this.same=null==e,this.alphaA=lt(t),this.alphaB=lt(e),i&&super.reset(i,r)}initialize(t){t.useAlpha=!0,t.transform.alphaA=this.alphaA.getValue(),t.transform.alphaB=this.same?t.transform.alphaA:this.alphaB.getValue()}mutate(t,e,i){this.energize(t,e,i),t.alpha=ut.lerp(t.transform.alphaA,t.transform.alphaB,this.energy),t.alpha<.002&&(t.alpha=0)}static fromJSON(t){const{alphaA:e,alphaB:i,life:r,easing:n,isEnabled:s=!0}=t;return new ze(e,i,r,j(n),s)}}class Me extends we{constructor(t=new Pt,e=100,i=1e3,r=1/0,n=_e,s=!0){super(r,n,"Attraction",s),this.targetPosition=t,this.radius=i,this.force=this.normalizeValue(e),this.radiusSq=this.radius*this.radius,this.attractionForce=new Pt,this.lengthSq=0}reset(t=new Pt,e=100,i=1e3,r,n){this.targetPosition=t,this.radius=i,this.force=this.normalizeValue(e),this.radiusSq=this.radius*this.radius,this.attractionForce=new Pt,this.lengthSq=0,r&&super.reset(r,n)}mutate(t,e,i){this.energize(t,e,i),this.attractionForce.copy(this.targetPosition),this.attractionForce.sub(t.position),this.lengthSq=this.attractionForce.lengthSq(),this.lengthSq>4e-6&&this.lengthSq<this.radiusSq&&(this.attractionForce.normalize(),this.attractionForce.scalar(1-this.lengthSq/this.radiusSq),this.attractionForce.scalar(this.force),t.acceleration.add(this.attractionForce))}static fromJSON(t){const{x:e,y:i,z:r,force:n,radius:s,life:o,easing:a,isEnabled:h=!0}=t;return new Me(new Pt(e,i,r),n,s,o,j(a),h)}}class Pe extends we{constructor(t,e,i,r,n,s=!0){super(r,n,"Collision",s),this.reset(t,e,i)}reset(t,e,i,r,n){this.emitter=t,this.useMass=e,this.onCollide=i,this.particles=[],this.delta=new Pt,r&&super.reset(r,n)}mutate(t,e,i){const r=this.emitter?this.emitter.particles.slice(i):this.particles.slice(i);let n,s,o,a,h,u,c=r.length;for(;c--;)n=r[c],n!=t&&(this.delta.copy(n.position).sub(t.position),s=this.delta.lengthSq(),a=t.radius+n.radius,s<=a*a&&(o=a-Math.sqrt(s),o+=.5,h=this._getAverageMass(t,n),u=this._getAverageMass(n,t),t.position.add(this.delta.clone().normalize().scalar(o*-h)),n.position.add(this.delta.normalize().scalar(o*u)),this.onCollide&&this.onCollide(t,n)))}_getAverageMass(t,e){return this.useMass?e.mass/(t.mass+e.mass):.5}fromJSON(t){}}class Ee extends we{constructor(t,e,i,r,n=!0){super(i,r,"Color",n),this.reset(t,e)}get same(){return this._same}set same(t){this._same=t}reset(t,e,i,r){this.same=null==e,this.colorA=gt(t),this.colorB=gt(e),i&&super.reset(i,r)}initialize(t){t.transform.colorA=Q.getRGB(this.colorA.getValue()),t.useColor=!0,t.transform.colorB=this.same?t.transform.colorA:Q.getRGB(this.colorB.getValue())}mutate(t,e,i){this.energize(t,e,i),this._same?(t.color.r=t.transform.colorA.r,t.color.g=t.transform.colorA.g,t.color.b=t.transform.colorA.b):(t.color.r=ut.lerp(t.transform.colorA.r,t.transform.colorB.r,this.energy),t.color.g=ut.lerp(t.transform.colorA.g,t.transform.colorB.g,this.energy),t.color.b=ut.lerp(t.transform.colorA.b,t.transform.colorB.b,this.energy))}static fromJSON(t){const{colorA:e,colorB:i,life:r,easing:n,isEnabled:s=!0}=t;return new Ee(e,i,r,j(n),s)}}class Oe extends we{constructor(t,e,i,r,n){super(i,r,"CrossZone",n),this.reset(t,e)}reset(t,e="dead",i,r){this.zone=t,this.zone.crossType=e,i&&super.reset(i,r)}mutate(t,e,i){this.energize(t,e,i),this.zone.crossing.call(this.zone,t)}static fromJSON(t){const{zoneType:e,zoneParams:i,crossType:n,life:s,easing:o,isEnabled:a=!0}=t,h=new r[e](...Object.values(i));return new Oe(h,n,s,j(o),a)}}class Te extends we{constructor(t,e,i,r,n,s=!0){super(r,n,"Force",s),this.reset(t,e,i)}reset(t,e,i){this.force=this.normalizeForce(new Pt(t,e,i)),this.force.id=Math.random()}mutate(t,e,i){this.energize(t,e,i),t.acceleration.add(this.force)}static fromJSON(t){const{fx:e,fy:i,fz:r,life:n,easing:s,isEnabled:o=!0}=t;return new Te(e,i,r,n,j(s),o)}}class Se extends Te{constructor(t,e,i,r=!0){super(0,-t,0,e,i,r),this.type="Gravity"}static fromJSON(t){const{gravity:e,life:i,easing:r,isEnabled:n=!0}=t;return new Se(e,i,j(r),n)}}class Ae extends we{constructor(t,e,i,r=.03,n,s,o=!0){super(n,s,"RandomDrift",o),this.reset(t,e,i,r),this.time=0}reset(t,e,i,r=.03,n,s){this.randomForce=this.normalizeForce(new Pt(t,e,i)),this.delayPan=lt(r),this.time=0,n&&super.reset(n,s)}mutate(t,e,i){if(this.energize(t,e,i),this.time+=e,this.time>=this.delayPan.getValue()){const e=ut.randomAToB(-this.randomForce.x,this.randomForce.x),i=ut.randomAToB(-this.randomForce.y,this.randomForce.y),r=ut.randomAToB(-this.randomForce.z,this.randomForce.z);t.acceleration.addValue(e,i,r),this.time=0}}static fromJSON(t){const{x:e,y:i,z:r,delay:n,life:s,easing:o,isEnabled:a=!0}=t;return new Ae(e,i,r,n,s,j(o),a)}}class Ce extends Me{constructor(t,e,i,r,n,s=!0){super(t,e,i,r,n,s),this.force*=-1,this.type="Repulsion"}reset(t,e,i,r,n){super.reset(t,e,i,r,n),this.force*=-1}static fromJSON(t){const{x:e,y:i,z:r,force:n,radius:s,life:o,easing:a,isEnabled:h=!0}=t;return new Ce(new Pt(e,i,r),n,s,o,j(a),h)}}class je extends we{constructor(t,e,i,r,n,s=!0){super(r,n,"Rotate",s),this.reset(t,e,i)}get rotationType(){return this._rotationType}set rotationType(t){this._rotationType=t}reset(t,e,i,r,n){this.x=t||0,this.y=e||0,this.z=i||0,void 0===t||"same"==t?this.rotationType="same":null==e?this.rotationType="set":void 0===i?this.rotationType="to":(this.rotationType="add",this.x=lt(this.x*a.a),this.y=lt(this.y*a.a),this.z=lt(this.z*a.a)),r&&super.reset(r,n)}initialize(t){switch(this.rotationType){case"same":break;case"set":this._setRotation(t.rotation,this.x);break;case"to":t.transform.fR=t.transform.fR||new Pt,t.transform.tR=t.transform.tR||new Pt,this._setRotation(t.transform.fR,this.x),this._setRotation(t.transform.tR,this.y);break;case"add":t.transform.addR=new Pt(this.x.getValue(),this.y.getValue(),this.z.getValue())}}_setRotation(t,e){if(t=t||new Pt,"random"==e){var i=ut.randomAToB(-a.d,a.d),r=ut.randomAToB(-a.d,a.d),n=ut.randomAToB(-a.d,a.d);t.set(i,r,n)}else e instanceof Pt&&t.copy(e)}mutate(t,e,i){switch(this.energize(t,e,i),this.rotationType){case"same":t.rotation||(t.rotation=new Pt),t.rotation.eulerFromDir(t.velocity);break;case"set":break;case"to":t.rotation.x=ut.lerp(t.transform.fR.x,t.transform.tR.x,this.energy),t.rotation.y=ut.lerp(t.transform.fR.y,t.transform.tR.y,this.energy),t.rotation.z=ut.lerp(t.transform.fR.z,t.transform.tR.z,this.energy);break;case"add":t.rotation.add(t.transform.addR)}}static fromJSON(t){const{x:e,y:i,z:r,life:n,easing:s,isEnabled:o=!0}=t;return new je(e,i,r,n,j(s),o)}}class Re extends we{constructor(t,e,i,r,n=!0){super(i,r,"Scale",n),this.reset(t,e)}get same(){return this._same}set same(t){this._same=t}reset(t,e,i,r){this.same=null==e,this.scaleA=lt(t||1),this.scaleB=lt(e),i&&super.reset(i,r)}initialize(t){t.transform.scaleA=this.scaleA.getValue(),t.transform.oldRadius=t.radius,t.transform.scaleB=this.same?t.transform.scaleA:this.scaleB.getValue()}mutate(t,e,i){this.energize(t,e,i),t.scale=ut.lerp(t.transform.scaleA,t.transform.scaleB,this.energy),t.scale<5e-4&&(t.scale=0),t.radius=t.transform.oldRadius*t.scale}static fromJSON(t){const{scaleA:e,scaleB:i,life:r,easing:n,isEnabled:s=!0}=t;return new Re(e,i,r,j(n),s)}}class Ie extends we{constructor(t,e,i,r,n,s,o,a=!0){super(s,o,"Spring",a),this.reset(t,e,i,r,n)}reset(t,e,i,r,n){this.pos?this.pos.set(t,e,i):this.pos=new Pt(t,e,i),this.spring=r||.1,this.friction=n||.98}mutate(t,e,i){this.energize(t,e,i),t.velocity.x+=(this.pos.x-t.position.x)*this.spring,t.velocity.y+=(this.pos.y-t.position.y)*this.spring,t.velocity.z+=(this.pos.z-t.position.z)*this.spring}static fromJSON(t){const{x:e,y:i,z:r,spring:n,friction:s,life:o,easing:a,isEnabled:h=!0}=t;return new Ie(e,i,r,n,s,o,j(a),h)}}const De=t=>{const e=[];return t.forEach(t=>{const{type:i,properties:r}=t;if(!D.includes(i))throw new Error("The behaviour type ".concat(i," is invalid or not yet supported"));e.push(s[i].fromJSON(r))}),e};var Be=(t,e,i,r)=>{const{preParticles:s=a.e,integrationType:h=a.b,emitters:u=[]}=t,c=new i(e,s,h);return u.forEach(t=>{const i=new r,{rate:s,rotation:a,initializers:h,behaviours:u,emitterBehaviours:l=[],position:d,totalEmitTimes:p=1/0,life:f=1/0}=t;i.setRate((t=>ue.fromJSON(t))(s)).setRotation(a).setInitializers(((t,e)=>{const i=[];return t.forEach(t=>{const{type:r,properties:s}=t;if(!I.includes(r))throw new Error("The initializer type ".concat(r," is invalid or not yet supported"));o.includes(r)?i.push(n[r].fromJSON(s,e)):i.push(n[r].fromJSON(s))}),i})(h,e)).setBehaviours(De(u)).setEmitterBehaviours(De(l)).setPosition(d).emit(p,f),c.addEmitter(i)}),c};function Ve(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function ke(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ve(Object(i),!0).forEach((function(e){J()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ve(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}const Fe={shouldAutoEmit:!0},Ze=t=>new Promise((e,i)=>{if(!t.length)return e([]);const r=t.length,n=[];t.forEach(t=>{const{type:o,properties:a}=t;return D.includes(o)?(n.push(s[o].fromJSON(a)),n.length===r?e(n):void 0):i("The behaviour type ".concat(o," is invalid or not yet supported"))})}),Le=(t,e,i,r)=>new Promise((s,a)=>{if(!t.length)return s([]);const h=[],u=t.length;if(!u)return s(h);t.forEach(t=>{const c=new e,{rate:l,rotation:d,initializers:p,behaviours:f,emitterBehaviours:y=[],position:m,totalEmitTimes:g=1/0,life:x=1/0}=t;var v;c.setRate((v=l,ue.fromJSON(v))).setRotation(d).setPosition(m),((t,e)=>new Promise((i,r)=>{if(!t.length)return i([]);const s=t.length,a=[],h=t.filter(({properties:t})=>!t.texture),u=t.filter(({properties:t})=>t.texture);h.forEach(t=>{const{type:h,properties:u}=t;return I.includes(h)?(o.includes(h)?a.push(n[h].fromJSON(u,e)):a.push(n[h].fromJSON(u)),a.length===s?i(a):void 0):r("The initializer type ".concat(h," is invalid or not yet supported"))}),u.forEach(t=>{const{type:n,properties:o,properties:{texture:h}}=t,u=new e.TextureLoader;if(!I.includes(n))return r("The initializer type ".concat(n," is invalid or not yet supported"));u.load(h,t=>{if(a.push(de.fromJSON(ke(ke({},o),{},{loadedTexture:t}),e)),a.length===s)return i(a)},void 0,r)})}))(p,i).then(t=>(c.setInitializers(t),Ze(f))).then(t=>(c.setBehaviours(t),Ze(y))).then(t=>(c.setEmitterBehaviours(t),Promise.resolve(c))).then(t=>{if(h.push(r?t.emit(g,x):t.setTotalEmitTimes(g).setLife(x)),h.length===u)return s(h)}).catch(a)})});class Ue{constructor(t=a.e,e=vt){this.type="System",this.canUpdate=!0,this.preParticles=t,this.integrationType=e,this.emitters=[],this.renderers=[],this.pool=new Tt,this.eventDispatcher=new St}static fromJSON(t,e){return Be(t,e,Ue,be)}static fromJSONAsync(t,e,i){return((t,e,i,r,n={})=>new Promise((s,o)=>{const{preParticles:h=a.e,integrationType:u=a.b,emitters:c=[]}=t,l=new i(h,u),{shouldAutoEmit:d}=ke(ke({},Fe),n);Le(c,r,e,d).then(t=>{const e=t.length;if(!e)return s(l);t.forEach(t=>{l.addEmitter(t),l.emitters.length===e&&s(l)})}).catch(o)}))(t,e,Ue,be,i)}dispatch(t,e=this){this.eventDispatcher.dispatchEvent(t,e)}addRenderer(t){return this.renderers.push(t),t.init(this),this}removeRenderer(t){return this.renderers.splice(this.renderers.indexOf(t),1),t.remove(this),this}addEmitter(t){const e=this.emitters.length;return t.parent=this,t.index=e,this.emitters.push(t),this.dispatch("EMITTER_ADDED",t),this}removeEmitter(t){return t.parent!==this||(t.parent=null,t.index=void 0,this.emitters.splice(this.emitters.indexOf(t),1),this.dispatch("EMITTER_REMOVED",t)),this}emit({onStart:t,onUpdate:e,onEnd:i}){t&&t(),e&&this.eventDispatcher.addEventListener("SYSTEM_UPDATE",e);const r=this.emitters.map(t=>{const{life:e}=t;return e===1/0?(i&&i(),t.experimental_emit(),Promise.resolve()):new Promise(e=>{t.addOnEmitterDeadEventListener(()=>{i&&i(),e()}),t.experimental_emit()})});try{return Promise.all(r)}catch(t){console.warn(t)}}update(t=.0167){const e=t||.0167;if(this.canUpdate){if(e>0){let t=this.emitters.length;for(;t--;){const i=this.emitters[t];i.update(e),i.isEmitting&&this.dispatch("SYSTEM_UPDATE")}}this.dispatch("SYSTEM_UPDATE_AFTER")}return Promise.resolve()}getCount(){const t=this.emitters.length;let e,i=0;for(e=0;e<t;e++)i+=this.emitters[e].particles.length;return i}destroy(){const t=this.emitters.length;this.canUpdate=!1;for(let e=0;e<t;e++)this.emitters[e]&&this.emitters[e].destroy(),delete this.emitters[e];for(let e=0;e<t;e++)this.renderers[e]&&this.renderers[e].destroy&&(this.renderers[e].destroy(),delete this.renderers[e]);this.emitters.length=0,this.pool.destroy(),this.canUpdate=!0}}const Ne=15,qe=0;var Ge={addEventListener:function(t,e){return t.eventDispatcher.addEventListener("SYSTEM_UPDATE",e),this},drawZone:function(t,e,i,r={}){const{width:n=Ne,height:s=Ne,depth:o=Ne,radius:a=Ne,x:h=qe,y:u=qe,z:c=qe}=r;let l;r.isPointZone()&&(l=new t.SphereGeometry(15)),r.isLineZone(),r.isBoxZone()&&(l=new t.BoxGeometry(n,s,o)),r.isSphereZone()&&(l=new t.SphereGeometry(a,Ne,Ne)),r.isMeshZone()&&(l=r.geometry.geometry?r.geometry.geometry.clone():r.geometry.clone()),l||(l=new t.BoxGeometry(n,s,o));const d=new t.MeshBasicMaterial({color:"#2194ce",wireframe:!0}),p=new t.Mesh(l.clone(),d);i.add(p),this.addEventListener(e,(function(){p.position.set(h,u,c)}))},drawEmitter:function(t,e,i,r,n){const s=new t.OctahedronGeometry(Ne),o=new t.MeshBasicMaterial({color:n||"#aaa",wireframe:!0}),a=new t.Mesh(s.clone(),o);i.add(a),this.addEventListener(e,(function(){a.position.copy(r.position),a.rotation.set(r.rotation.x,r.rotation.y,r.rotation.z)}))},renderInfo:function(){function t(t,e){var i="material"==t?"_materialPool":"_targetPool";return e.renderers[0][i].cID}return function(e,i){this.addInfo(i);var r="";switch(this._infoType){case 2:r+="emitter:"+e.emitters.length+"<br>",r+="em speed:"+e.emitters[0].cID+"<br>",r+="pos:"+function(t){var e=t.emitters[0];return Math.round(e.p.x)+","+Math.round(e.p.y)+","+Math.round(e.p.z)}(e);break;case 3:r+=e.renderers[0].name+"<br>",r+="target:"+t("target")+"<br>",r+="material:"+t("material");break;default:r+="particles:"+e.getCount()+"<br>",r+="pool:"+e.pool.getCount()+"<br>",r+="total:"+(e.getCount()+e.pool.getCount())}this._infoCon.innerHTML=r}}(),addInfo:function(t){var e=this;if(!this._infoCon){var i,r;switch(this._infoCon=document.createElement("div"),this._infoCon.style.cssText=["position:fixed;bottom:0px;left:0;cursor:pointer;","opacity:0.9;z-index:10000;padding:10px;font-size:12px;","width:120px;height:50px;background-color:#002;color:#0ff;"].join(""),this._infoType=1,this._infoCon.addEventListener("click",(function(){e._infoType++,e._infoType>3&&(e._infoType=1)}),!1),t){case 2:i="#201",r="#f08";break;case 3:i="#020",r="#0f0";break;default:i="#002",r="#0ff"}this._infoCon.style["background-color"]=i,this._infoCon.style.color=r}this._infoCon.parentNode||document.body.appendChild(this._infoCon)}},Ye=function(){let t=0;if(window.console&&window.console.trace){var e=Array.prototype.slice.call(arguments),i=arguments[0]+"";if(0==i.indexOf("+")){var r=parseInt(arguments[0]);t<r&&(e.shift(),console.trace.apply(console,e),t++)}else e.unshift("+15"),this.apply(console,e)}};class Xe extends be{constructor(t,e,i){super(i),this.type="FollowEmitter",this.mouseTarget=rt.initValue(t,window),this.ease=rt.initValue(e,.7),this._allowEmitting=!1,this.initEventHandler()}initEventHandler(){var t=this;this.mousemoveHandler=function(e){t.mousemove.call(t,e)},this.mousedownHandler=function(e){t.mousedown.call(t,e)},this.mouseupHandler=function(e){t.mouseup.call(t,e)},this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,!1)}emit(){this._allowEmitting=!0}stopEmit(){this._allowEmitting=!1}setCameraAndCanvas(t,e){this.camera=t,this.canvas=e}mousemove(t){t.layerX||0==t.layerX?(this.position.x+=(t.layerX-this.position.x)*this.ease,this.position.y+=(t.layerY-this.position.y)*this.ease):(t.offsetX||0==t.offsetX)&&(this.position.x+=(t.offsetX-this.position.x)*this.ease,this.position.y+=(t.offsetY-this.position.y)*this.ease),this.position.copy(it.toSpacePos(this.position,this.camera,this.canvas)),this._allowEmitting&&super.emit("once")}destroy(){super.destroy(),this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,!1)}}class Je{constructor(t="BaseRenderer"){this.type=t}init(t){var e=this;this.system=t,this.system.eventDispatcher.addEventListener("SYSTEM_UPDATE",(function(t){e.onSystemUpdate.call(e,t)})),this.system.eventDispatcher.addEventListener("PARTICLE_CREATED",(function(t){e.onParticleCreated.call(e,t)})),this.system.eventDispatcher.addEventListener("PARTICLE_UPDATE",(function(t){e.onParticleUpdate.call(e,t)})),this.system.eventDispatcher.addEventListener("PARTICLE_DEAD",(function(t){e.onParticleDead.call(e,t)})),this.logRendererType()}remove(){this.system=null}onParticleCreated(t){}onParticleUpdate(t){}onParticleDead(t){}onSystemUpdate(t){}logRendererType(){a.f&&console.log("".concat(this.type))}}class Qe extends Je{constructor(){super("CustomRenderer"),this.targetPool=new Tt,this.materialPool=new Tt}onSystemUpdate(){}onParticleCreated(t){}onParticleUpdate(t){}onParticleDead(t){}}class He extends Je{constructor(t,e){super("MeshRenderer"),this.container=t,this._targetPool=new Tt,this._materialPool=new Tt,this._body=new e.Mesh(new e.BoxGeometry(50,50,50),new e.MeshLambertMaterial({color:"#ff0000"}))}isThreeSprite(t){return t.target.isSprite}onSystemUpdate(){}onParticleCreated(t){t.target||(t.body||(t.body=this._body),t.target=this._targetPool.get(t.body),(t.useAlpha||t.useColor)&&(t.target.material.__puid=H.id(t.body.material),t.target.material=this._materialPool.get(t.target.material))),t.target&&(t.target.position.copy(t.position),this.container.add(t.target))}onParticleUpdate(t){const{target:e,useAlpha:i,useColor:r,rotation:n}=t;e&&(e.position.copy(t.position),this.isThreeSprite(t)||e.rotation.set(n.x,n.y,n.z),this.scale(t),i&&(e.material.opacity=t.alpha,e.material.transparent=!0),r&&e.material.color.copy(t.color))}scale(t){t.target.scale.set(t.scale,t.scale,t.scale)}onParticleDead(t){t.target&&((t.useAlpha||t.useColor)&&this._materialPool.expire(t.target.material),this._targetPool.expire(t.target),this.container.remove(t.target),t.target=null)}}class We extends He{constructor(t,e){super(t,e),this.type="SpriteRenderer",this._body=new e.Sprite(new e.SpriteMaterial({color:16777215}))}scale(t){t.target.scale.set(t.scale*t.radius,t.scale*t.radius,1)}}const Ke=["x","y","z"].length,$e=["r","g","b","a"].length,ti=[4*Ke,4,4*$e].reduce((t,e)=>t+e),ei=1,ii=1,ri=2,ni={position:Ke,size:ei,color:$e,alpha:ii,texID:ri},si=([Ke,ei,$e,ii,ri].reduce((t,e)=>t+e),{blending:"AdditiveBlending",baseColor:16777215,depthTest:!0,depthWrite:!1,transparent:!0,maxParticles:1e4,shouldDebugTextureAtlas:!1,shouldForceDesktopRenderer:!1,shouldForceMobileRenderer:!1});class oi{constructor(t){this.position=new t.Vector3,this.size=0,this.color=new t.Color,this.alpha=0,this.texture=null,this.index=0}reset(){this.position.set(0,0,0),this.size=0,this.color.setRGB(0,0,0),this.alpha=0,this.texture=null}}class ai{constructor(t=1/0){this.max=t,this.count=0,this._items={}}add(t){void 0===this._items[t]&&(this._items[t]=this.count++)}find(t){return this._items[t]}destroy(){this._items={},this.count=0}}let hi;class ui{constructor(t=1e4,e){hi=e,this.maxParticles=t,this.createInterleavedBuffer().createBufferGeometry()}createInterleavedBuffer(){const t=new ArrayBuffer(this.maxParticles*ti);return this.interleavedBuffer=new hi.InterleavedBuffer(new Float32Array(t),ti),this}createBufferGeometry(){this.geometry=new hi.BufferGeometry;const{interleavedBuffer:t,geometry:e}=this;return Object.keys(ni).reduce((i,r)=>{const n=ni[r];return e.setAttribute(r,new hi.InterleavedBufferAttribute(t,n,i)),i+n},0),this}get buffer(){return this.interleavedBuffer}get stride(){return ti}}class ci{constructor(t,e){const{three:i,type:r}=t,n=new Float32Array(1024),s=this.ctx=document.createElement("canvas").getContext("2d"),{canvas:o}=s;this.shouldDebug=e,this.rendererType=r,this.indexData=n,this.canvas=o,this.entries=[],"DesktopGPURenderer"===r&&(this.atlasIndex=new i.DataTexture(n,256,1,i.RGBAFormat,i.FloatType)),o.width=o.height=256,e&&this.debug(o,s),this.atlasTexture=new i.CanvasTexture(o),this.atlasTexture.flipY=!1,t.material.uniforms.uTexture.value=this.atlasTexture,"DesktopGPURenderer"===r&&(t.material.uniforms.atlasIndex.value=this.atlasIndex),t.material.uniformsNeedUpdate=!0}log(...t){a.f&&console.log(...t)}debug(){const{canvas:t,ctx:e}=this,i=t.width;e.fillStyle="purple",e.fillRect(0,0,i,i),e.fillStyle="green",e.fillRect(0,i,i,i),e.fillStyle="blue",e.fillRect(i,0,i,i),e.fillStyle="orange",e.fillRect(i,i,i,i),e.fillStyle="yellow",e.font=t.width+"px Verdana",e.fillText("top row",100,500),e.fillStyle="pink",e.fillText("bottom row",100,1500),t.style.position="absolute",t.style.width=t.style.height="300px",t.style.left=t.style.top="0px",t.style.zIndex=100,document.body.appendChild(t)}addTexture(t){this.log("Adding texture to atlas:",t.uuid),t.textureIndex=this.entries.length,this.entries.push({texture:t}),this.needsUpdate=!0}update(){if(!this.needsUpdate)return;const{entries:t,canvas:e,indexData:i,ctx:r,atlasIndex:n,atlasTexture:s,rendererType:o}=this;for(let e=0;e<t.length;e++)if(!t[e].texture.image)return;this.needsUpdate=!1;for(let e=0;e<t.length;e++){const i=t[e],{texture:r}=i,{width:n,height:s}=r.image;i.w=n,i.h=s}const a=function(t){let e=0,i=0;for(const r of t)e+=r.w*r.h,i=Math.max(i,r.w);t.sort((t,e)=>e.h-t.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let n=0,s=0;for(const e of t)for(let t=r.length-1;t>=0;t--){const i=r[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,s=Math.max(s,e.y+e.h),n=Math.max(n,e.x+e.w),e.w===i.w&&e.h===i.h){const e=r.pop();t<r.length&&(r[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(r.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:n,h:s,fill:e/(n*s)||0}}(t);this.log("Rebuilt atlas:",a),e.width==a.w&&e.height==a.h||(e.width=a.w,e.height=a.h);for(let n=0;n<t.length;n++){const t=this.entries[n],s=4*t.texture.textureIndex;"DesktopGPURenderer"===o&&(i[s+0]=t.x/e.width,i[s+1]=t.y/e.height,i[s+2]=(t.x+t.w)/e.width,i[s+3]=(t.y+t.h)/e.height),"MobileGPURenderer"===o&&(i[s+0]=t.x/(e.width+1),i[s+1]=t.y/(e.height+1),i[s+2]=(t.x+t.w)/(e.width+1),i[s+3]=(t.y+t.h)/(e.height+1)),r.drawImage(t.texture.image,t.x,t.y,t.w,t.h)}"DesktopGPURenderer"===o&&(n.needsUpdate=!0),s.needsUpdate=!0}destroy(){const{atlasIndex:t,atlasTexture:e,canvas:i}=this;e.dispose(),t&&t.dispose(),this.shouldDebug&&i.remove(),this.entries=[]}}function li(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function di(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?li(Object(i),!0).forEach((function(e){J()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):li(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}let pi;class fi extends Je{constructor(t,e,i=si){super("DesktopGPURenderer"),pi=this.three=e;const r=di(di({},si),i),{camera:n,maxParticles:s,baseColor:o,blending:a,depthTest:h,depthWrite:u,transparent:c,shouldDebugTextureAtlas:l}=r,d=new ui(s,pi),p=new pi.ShaderMaterial({uniforms:{baseColor:{value:new pi.Color(o)},uTexture:{value:null},atlasIndex:{value:null}},vertexShader:"\n    uniform sampler2D uTexture;\n    //atlasIndex is a 256x1 float texture of tile rectangles as r=minx g=miny b=maxx a=maxy\n    uniform sampler2D atlasIndex;\n\n    attribute float size;\n    attribute vec3 color;\n    attribute float alpha;\n    attribute float texID;\n\n    varying vec3 targetColor;\n    varying float targetAlpha;\n    varying vec4 tileRect;\n    varying float tileID;\n\n    void main() {\n      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n      targetColor = color;\n      targetAlpha = alpha;\n\n      tileID = texID;\n      //get the tile rectangle from the atlasIndex texture..\n      tileRect = texture2D(atlasIndex, vec2((tileID + 0.5) / ".concat(256,".0, 0.5));\n\n      gl_PointSize = ((size * ").concat("600.0",") / -mvPosition.z);\n      gl_Position = projectionMatrix * mvPosition;\n    }\n"),fragmentShader:"\n    uniform vec3 baseColor;\n    uniform sampler2D uTexture;\n    uniform sampler2D atlasIndex;\n\n    varying vec3 targetColor;\n    varying float targetAlpha;\n    varying vec4 tileRect;\n    varying float tileID;\n\n    void main() {\n      gl_FragColor = vec4(baseColor * targetColor, targetAlpha);\n\n      vec2 uv = gl_PointCoord;\n      uv = mix(tileRect.xy, tileRect.zw, gl_PointCoord);\n\n      gl_FragColor = gl_FragColor * texture2D(uTexture, uv);\n\n    }\n",blending:pi[a],depthTest:h,depthWrite:u,transparent:c});this.container=t,this.camera=n,this.targetPool=new Tt,this.uniqueList=new ai(s),this.particleBuffer=d,this.buffer=d.buffer,this.stride=d.stride,this.geometry=d.geometry,this.material=p,this.points=new pi.Points(this.geometry,this.material),this.points.frustumCulled=!1,this.shouldDebugTextureAtlas=l,this.container.add(this.points)}onSystemUpdate(t){super.onSystemUpdate(t),this.buffer.needsUpdate=!0,this.textureAtlas&&this.textureAtlas.update()}onParticleCreated(t){t.target||(t.target=this.targetPool.get(oi,pi),this.uniqueList.add(t.id)),this.updateTarget(t).mapParticleTargetPropsToPoint(t)}onParticleUpdate(t){t.target&&this.updateTarget(t).mapParticleTargetPropsToPoint(t)}onParticleDead(t){t.target&&(t.target.reset(),this.mapParticleTargetPropsToPoint(t),t.target=null)}updateTarget(t){const{position:e,scale:i,radius:r,color:n,alpha:s,body:o,id:a}=t,{r:h,g:u,b:c}=n;if(t.target.position.copy(e),t.target.size=i*r,t.target.color.setRGB(h,u,c),t.target.alpha=s,t.target.index=this.uniqueList.find(a),o&&o instanceof pi.Sprite){const{map:e}=o.material;t.target.texture=e,t.target.textureIndex=this.getTextureID(e,this.shouldDebugTextureAtlas)}return this}mapParticleTargetPropsToPoint(t){return this.updatePointPosition(t).updatePointSize(t).updatePointColor(t).updatePointAlpha(t).updatePointTextureIndex(t),this}updatePointPosition(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.position;return r.array[n.index*i+s+0]=n.position.x,r.array[n.index*i+s+1]=n.position.y,r.array[n.index*i+s+2]=n.position.z,this}updatePointSize(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.size;return r.array[n.index*i+s+0]=n.size,this}updatePointColor(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.color;return r.array[n.index*i+s+0]=n.color.r,r.array[n.index*i+s+1]=n.color.g,r.array[n.index*i+s+2]=n.color.b,this}updatePointAlpha(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.alpha;return r.array[n.index*i+s+0]=n.alpha,this}updatePointTextureIndex(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.texID;return r.array[n.index*i+s+0]=n.textureIndex,this}getTextureID(t,e){return void 0===t.textureIndex&&(this.textureAtlas||(this.textureAtlas=new ci(this,e)),this.textureAtlas.addTexture(t)),t.textureIndex}destroy(){const{container:t,points:e,textureAtlas:i,uniqueList:r}=this;t.remove(e),r.destroy(),i&&i.destroy()}}function yi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function mi(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?yi(Object(i),!0).forEach((function(e){J()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):yi(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}let gi;class xi extends Je{constructor(t,e,i=si){super("MobileGPURenderer"),gi=this.three=e;const r=mi(mi({},si),i),{camera:n,maxParticles:s,baseColor:o,blending:a,depthTest:h,depthWrite:u,transparent:c,shouldDebugTextureAtlas:l}=r,d=new ui(s,gi),p=new gi.ShaderMaterial({uniforms:{baseColor:{value:new gi.Color(o)},uTexture:{value:null},FFatlasIndex:{value:null},atlasDim:{value:new gi.Vector2}},vertexShader:"\n    uniform sampler2D uTexture;\n    uniform vec2 atlasDim;\n\n    attribute float size;\n    attribute vec3 color;\n    attribute float alpha;\n    attribute vec2 texID;\n\n    varying vec3 targetColor;\n    varying float targetAlpha;\n    varying vec4 tileRect;\n\n    void main() {\n      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n      targetColor = color;\n      targetAlpha = alpha;\n\n      vec2 tmin = floor(texID) / atlasDim;\n      vec2 tmax = fract(texID);\n      tileRect = vec4(tmin,tmax);\n\n      gl_PointSize = ((size * ".concat("600.0",") / -mvPosition.z);\n      gl_Position = projectionMatrix * mvPosition;\n    }\n"),fragmentShader:"\n    uniform vec3 baseColor;\n    uniform sampler2D uTexture;\n\n    varying vec3 targetColor;\n    varying float targetAlpha;\n    varying vec4 tileRect;\n\n    void main() {\n      gl_FragColor = vec4(baseColor * targetColor, targetAlpha);\n\n      vec2 uv = gl_PointCoord;\n      uv = mix(tileRect.xy, tileRect.zw, gl_PointCoord);\n\n      gl_FragColor = gl_FragColor * texture2D(uTexture, uv);\n    }\n",blending:gi[a],depthTest:h,depthWrite:u,transparent:c});this.camera=n,this.targetPool=new Tt,this.uniqueList=new ai(s),this.particleBuffer=d,this.buffer=d.buffer,this.stride=d.stride,this.geometry=d.geometry,this.material=p,this.points=new gi.Points(this.geometry,this.material),this.points.frustumCulled=!1,this.shouldDebugTextureAtlas=l,t.add(this.points)}onSystemUpdate(t){super.onSystemUpdate(t),this.buffer.needsUpdate=!0;const{textureAtlas:e}=this;e&&(e.update(),this.material.uniforms.atlasDim.value.set(e.atlasTexture.image.width,e.atlasTexture.image.height))}onParticleCreated(t){t.target||(t.target=this.targetPool.get(oi,gi),this.uniqueList.add(t.id)),this.updateTarget(t).mapParticleTargetPropsToPoint(t)}onParticleUpdate(t){t.target&&this.updateTarget(t).mapParticleTargetPropsToPoint(t)}onParticleDead(t){t.target&&(t.target.reset(),this.mapParticleTargetPropsToPoint(t),t.target=null)}updateTarget(t){const{position:e,scale:i,radius:r,color:n,alpha:s,body:o,id:a}=t,{r:h,g:u,b:c}=n;if(t.target.position.copy(e),t.target.size=i*r,t.target.color.setRGB(h,u,c),t.target.alpha=s,t.target.index=this.uniqueList.find(a),o&&o instanceof gi.Sprite){const{map:e}=o.material;t.target.texture=e,t.target.textureIndex=this.getTextureID(e,this.shouldDebugTextureAtlas)}return this}mapParticleTargetPropsToPoint(t){return this.updatePointPosition(t).updatePointSize(t).updatePointColor(t).updatePointAlpha(t).updatePointTextureIndex(t),this}updatePointPosition(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.position;return r.array[n.index*i+s+0]=n.position.x,r.array[n.index*i+s+1]=n.position.y,r.array[n.index*i+s+2]=n.position.z,this}updatePointSize(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.size;return r.array[n.index*i+s+0]=n.size,this}updatePointColor(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.color;return r.array[n.index*i+s+0]=n.color.r,r.array[n.index*i+s+1]=n.color.g,r.array[n.index*i+s+2]=n.color.b,this}updatePointAlpha(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.alpha;return r.array[n.index*i+s+0]=n.alpha,this}updatePointTextureIndex(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.texID,o=n.index*i+s+0;{let t=4*n.textureIndex;const e=this.textureAtlas,i=e.indexData,s=i[t++],a=i[t++],h=i[t++],u=i[t++];r.array[o]=(s*e.atlasTexture.image.width|0)+h,r.array[o+1]=(a*e.atlasTexture.image.height|0)+u}return this}getTextureID(t,e){return void 0===t.textureIndex&&(this.textureAtlas||(this.textureAtlas=new ci(this,e)),this.textureAtlas.addTexture(t)),t.textureIndex}destroy(){const{container:t,points:e,textureAtlas:i,uniqueList:r}=this;t.remove(e),r.destroy(),i&&i.destroy()}}class vi extends Je{constructor(t,e,i=si){super("GPURenderer");const{shouldForceDesktopRenderer:r,shouldForceMobileRenderer:n}=i,s=[t,e,i];return r?new fi(...s):n?new xi(...s):this.isFloatingPointTextureSupported()?new fi(...s):new xi(...s)}isFloatingPointTextureSupported(){const t=document.createElement("canvas");if(window.WebGL2RenderingContext&&t.getContext("webgl2"))return!0;const e=!!t.getContext("webgl").getExtension("OES_texture_float");return t.remove(),e}}e.default=Ue}])}));
//# sourceMappingURL=three-nebula.js.map